<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Geocomputation with R</title>
  <meta name="description" content="A book on geographic data with R.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Geocomputation with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://geocompr.robinlovelace.net/" />
  <meta property="og:image" content="https://geocompr.robinlovelace.net/images/cover.png" />
  <meta property="og:description" content="A book on geographic data with R." />
  <meta name="github-repo" content="Robinlovelace/geocompr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Geocomputation with R" />
  
  <meta name="twitter:description" content="A book on geographic data with R." />
  <meta name="twitter:image" content="https://geocompr.robinlovelace.net/images/cover.png" />

<meta name="author" content="Robin Lovelace, Jakub Nowosad, Jannes Muenchow">


<meta name="date" content="2018-09-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="attr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.2/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99618359-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Geocomputation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#development"><i class="fa fa-check"></i>Development</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-geocomputation"><i class="fa fa-check"></i><b>1.1</b> What is geocomputation?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#why-geocomputation-with-r"><i class="fa fa-check"></i><b>1.2</b> Why geocomputation with R?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#software-for-geocomputation"><i class="fa fa-check"></i><b>1.3</b> Software for geocomputation</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#rs-spatial-ecosystem"><i class="fa fa-check"></i><b>1.4</b> R’s spatial ecosystem</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-history-of-r-spatial"><i class="fa fa-check"></i><b>1.5</b> The history of R-spatial</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="2" data-path="spatial-class.html"><a href="spatial-class.html"><i class="fa fa-check"></i><b>2</b> Geographic data in R</a><ul>
<li class="chapter" data-level="" data-path="spatial-class.html"><a href="spatial-class.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="spatial-class.html"><a href="spatial-class.html#vector-data"><i class="fa fa-check"></i><b>2.1</b> Vector data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="spatial-class.html"><a href="spatial-class.html#intro-sf"><i class="fa fa-check"></i><b>2.1.1</b> An introduction to simple features</a></li>
<li class="chapter" data-level="2.1.2" data-path="spatial-class.html"><a href="spatial-class.html#why-simple-features"><i class="fa fa-check"></i><b>2.1.2</b> Why simple features?</a></li>
<li class="chapter" data-level="2.1.3" data-path="spatial-class.html"><a href="spatial-class.html#basic-map"><i class="fa fa-check"></i><b>2.1.3</b> Basic map making</a></li>
<li class="chapter" data-level="2.1.4" data-path="spatial-class.html"><a href="spatial-class.html#base-args"><i class="fa fa-check"></i><b>2.1.4</b> Base plot arguments</a></li>
<li class="chapter" data-level="2.1.5" data-path="spatial-class.html"><a href="spatial-class.html#geometry"><i class="fa fa-check"></i><b>2.1.5</b> Geometry types</a></li>
<li class="chapter" data-level="2.1.6" data-path="spatial-class.html"><a href="spatial-class.html#sfg"><i class="fa fa-check"></i><b>2.1.6</b> Simple feature geometries (sfg)</a></li>
<li class="chapter" data-level="2.1.7" data-path="spatial-class.html"><a href="spatial-class.html#sfc"><i class="fa fa-check"></i><b>2.1.7</b> Simple feature columns (sfc)</a></li>
<li class="chapter" data-level="2.1.8" data-path="spatial-class.html"><a href="spatial-class.html#sf"><i class="fa fa-check"></i><b>2.1.8</b> The sf class</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="spatial-class.html"><a href="spatial-class.html#raster-data"><i class="fa fa-check"></i><b>2.2</b> Raster data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="spatial-class.html"><a href="spatial-class.html#an-introduction-to-raster"><i class="fa fa-check"></i><b>2.2.1</b> An introduction to raster</a></li>
<li class="chapter" data-level="2.2.2" data-path="spatial-class.html"><a href="spatial-class.html#basic-map-raster"><i class="fa fa-check"></i><b>2.2.2</b> Basic map making</a></li>
<li class="chapter" data-level="2.2.3" data-path="spatial-class.html"><a href="spatial-class.html#raster-classes"><i class="fa fa-check"></i><b>2.2.3</b> Raster classes</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="spatial-class.html"><a href="spatial-class.html#crs-intro"><i class="fa fa-check"></i><b>2.3</b> Coordinate Reference Systems</a><ul>
<li class="chapter" data-level="2.3.1" data-path="spatial-class.html"><a href="spatial-class.html#geographic-coordinate-systems"><i class="fa fa-check"></i><b>2.3.1</b> Geographic coordinate systems</a></li>
<li class="chapter" data-level="2.3.2" data-path="spatial-class.html"><a href="spatial-class.html#projected-coordinate-systems"><i class="fa fa-check"></i><b>2.3.2</b> Projected coordinate systems</a></li>
<li class="chapter" data-level="2.3.3" data-path="spatial-class.html"><a href="spatial-class.html#crs-in-r"><i class="fa fa-check"></i><b>2.3.3</b> CRSs in R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="spatial-class.html"><a href="spatial-class.html#units"><i class="fa fa-check"></i><b>2.4</b> Units</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-class.html"><a href="spatial-class.html#ex2"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="attr.html"><a href="attr.html"><i class="fa fa-check"></i><b>3</b> Attribute data operations</a><ul>
<li class="chapter" data-level="" data-path="attr.html"><a href="attr.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="attr.html"><a href="attr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="attr.html"><a href="attr.html#vector-attribute-manipulation"><i class="fa fa-check"></i><b>3.2</b> Vector attribute manipulation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="attr.html"><a href="attr.html#vector-attribute-subsetting"><i class="fa fa-check"></i><b>3.2.1</b> Vector attribute subsetting</a></li>
<li class="chapter" data-level="3.2.2" data-path="attr.html"><a href="attr.html#vector-attribute-aggregation"><i class="fa fa-check"></i><b>3.2.2</b> Vector attribute aggregation</a></li>
<li class="chapter" data-level="3.2.3" data-path="attr.html"><a href="attr.html#vector-attribute-joining"><i class="fa fa-check"></i><b>3.2.3</b> Vector attribute joining</a></li>
<li class="chapter" data-level="3.2.4" data-path="attr.html"><a href="attr.html#vec-attr-creation"><i class="fa fa-check"></i><b>3.2.4</b> Creating attributes and removing spatial information</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="attr.html"><a href="attr.html#manipulating-raster-objects"><i class="fa fa-check"></i><b>3.3</b> Manipulating raster objects</a><ul>
<li class="chapter" data-level="3.3.1" data-path="attr.html"><a href="attr.html#raster-subsetting"><i class="fa fa-check"></i><b>3.3.1</b> Raster subsetting</a></li>
<li class="chapter" data-level="3.3.2" data-path="attr.html"><a href="attr.html#summarizing-raster-objects"><i class="fa fa-check"></i><b>3.3.2</b> Summarizing raster objects</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="attr.html"><a href="attr.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-operations.html"><a href="spatial-operations.html"><i class="fa fa-check"></i><b>4</b> Spatial data operations</a><ul>
<li class="chapter" data-level="" data-path="spatial-operations.html"><a href="spatial-operations.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="spatial-operations.html"><a href="spatial-operations.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-vec"><i class="fa fa-check"></i><b>4.2</b> Spatial operations on vector data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-subsetting"><i class="fa fa-check"></i><b>4.2.1</b> Spatial subsetting</a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-operations.html"><a href="spatial-operations.html#topological-relations"><i class="fa fa-check"></i><b>4.2.2</b> Topological relations</a></li>
<li class="chapter" data-level="4.2.3" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-joining"><i class="fa fa-check"></i><b>4.2.3</b> Spatial joining</a></li>
<li class="chapter" data-level="4.2.4" data-path="spatial-operations.html"><a href="spatial-operations.html#non-overlapping-joins"><i class="fa fa-check"></i><b>4.2.4</b> Non-overlapping joins</a></li>
<li class="chapter" data-level="4.2.5" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-aggr"><i class="fa fa-check"></i><b>4.2.5</b> Spatial data aggregation</a></li>
<li class="chapter" data-level="4.2.6" data-path="spatial-operations.html"><a href="spatial-operations.html#distance-relations"><i class="fa fa-check"></i><b>4.2.6</b> Distance relations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-ras"><i class="fa fa-check"></i><b>4.3</b> Spatial operations on raster data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-raster-subsetting"><i class="fa fa-check"></i><b>4.3.1</b> Spatial subsetting</a></li>
<li class="chapter" data-level="4.3.2" data-path="spatial-operations.html"><a href="spatial-operations.html#map-algebra"><i class="fa fa-check"></i><b>4.3.2</b> Map algebra</a></li>
<li class="chapter" data-level="4.3.3" data-path="spatial-operations.html"><a href="spatial-operations.html#local-operations"><i class="fa fa-check"></i><b>4.3.3</b> Local operations</a></li>
<li class="chapter" data-level="4.3.4" data-path="spatial-operations.html"><a href="spatial-operations.html#focal-operations"><i class="fa fa-check"></i><b>4.3.4</b> Focal operations</a></li>
<li class="chapter" data-level="4.3.5" data-path="spatial-operations.html"><a href="spatial-operations.html#zonal-operations"><i class="fa fa-check"></i><b>4.3.5</b> Zonal operations</a></li>
<li class="chapter" data-level="4.3.6" data-path="spatial-operations.html"><a href="spatial-operations.html#global-operations-and-distances"><i class="fa fa-check"></i><b>4.3.6</b> Global operations and distances</a></li>
<li class="chapter" data-level="4.3.7" data-path="spatial-operations.html"><a href="spatial-operations.html#merging-rasters"><i class="fa fa-check"></i><b>4.3.7</b> Merging rasters</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="spatial-operations.html"><a href="spatial-operations.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="geometric-operations.html"><a href="geometric-operations.html"><i class="fa fa-check"></i><b>5</b> Geometry operations</a><ul>
<li class="chapter" data-level="" data-path="geometric-operations.html"><a href="geometric-operations.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.1" data-path="geometric-operations.html"><a href="geometric-operations.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="geometric-operations.html"><a href="geometric-operations.html#geo-vec"><i class="fa fa-check"></i><b>5.2</b> Geometric operations on vector data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="geometric-operations.html"><a href="geometric-operations.html#simplification"><i class="fa fa-check"></i><b>5.2.1</b> Simplification</a></li>
<li class="chapter" data-level="5.2.2" data-path="geometric-operations.html"><a href="geometric-operations.html#centroids"><i class="fa fa-check"></i><b>5.2.2</b> Centroids</a></li>
<li class="chapter" data-level="5.2.3" data-path="geometric-operations.html"><a href="geometric-operations.html#buffers"><i class="fa fa-check"></i><b>5.2.3</b> Buffers</a></li>
<li class="chapter" data-level="5.2.4" data-path="geometric-operations.html"><a href="geometric-operations.html#affine-transformations"><i class="fa fa-check"></i><b>5.2.4</b> Affine transformations</a></li>
<li class="chapter" data-level="5.2.5" data-path="geometric-operations.html"><a href="geometric-operations.html#clipping"><i class="fa fa-check"></i><b>5.2.5</b> Clipping</a></li>
<li class="chapter" data-level="5.2.6" data-path="geometric-operations.html"><a href="geometric-operations.html#geometry-unions"><i class="fa fa-check"></i><b>5.2.6</b> Geometry unions</a></li>
<li class="chapter" data-level="5.2.7" data-path="geometric-operations.html"><a href="geometric-operations.html#type-trans"><i class="fa fa-check"></i><b>5.2.7</b> Type transformations</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="geometric-operations.html"><a href="geometric-operations.html#geo-ras"><i class="fa fa-check"></i><b>5.3</b> Geometric operations on raster data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="geometric-operations.html"><a href="geometric-operations.html#geometric-intersections"><i class="fa fa-check"></i><b>5.3.1</b> Geometric intersections</a></li>
<li class="chapter" data-level="5.3.2" data-path="geometric-operations.html"><a href="geometric-operations.html#extent-and-origin"><i class="fa fa-check"></i><b>5.3.2</b> Extent and origin</a></li>
<li class="chapter" data-level="5.3.3" data-path="geometric-operations.html"><a href="geometric-operations.html#aggregation-and-disaggregation"><i class="fa fa-check"></i><b>5.3.3</b> Aggregation and disaggregation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="geometric-operations.html"><a href="geometric-operations.html#raster-vector"><i class="fa fa-check"></i><b>5.4</b> Raster-vector interactions</a><ul>
<li class="chapter" data-level="5.4.1" data-path="geometric-operations.html"><a href="geometric-operations.html#raster-cropping"><i class="fa fa-check"></i><b>5.4.1</b> Raster cropping</a></li>
<li class="chapter" data-level="5.4.2" data-path="geometric-operations.html"><a href="geometric-operations.html#raster-extraction"><i class="fa fa-check"></i><b>5.4.2</b> Raster extraction</a></li>
<li class="chapter" data-level="5.4.3" data-path="geometric-operations.html"><a href="geometric-operations.html#rasterization"><i class="fa fa-check"></i><b>5.4.3</b> Rasterization</a></li>
<li class="chapter" data-level="5.4.4" data-path="geometric-operations.html"><a href="geometric-operations.html#spatial-vectorization"><i class="fa fa-check"></i><b>5.4.4</b> Spatial vectorization</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="geometric-operations.html"><a href="geometric-operations.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html"><i class="fa fa-check"></i><b>6</b> Reprojecting geographic data</a><ul>
<li class="chapter" data-level="" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="6.1" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#when-to-reproject"><i class="fa fa-check"></i><b>6.2</b> When to reproject?</a></li>
<li class="chapter" data-level="6.3" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#which-crs-to-use"><i class="fa fa-check"></i><b>6.3</b> Which CRS to use?</a></li>
<li class="chapter" data-level="6.4" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#reproj-vec-geom"><i class="fa fa-check"></i><b>6.4</b> Reprojecting vector geometries</a></li>
<li class="chapter" data-level="6.5" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#modifying-map-projections"><i class="fa fa-check"></i><b>6.5</b> Modifying map projections</a></li>
<li class="chapter" data-level="6.6" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#reprojecting-raster-geometries"><i class="fa fa-check"></i><b>6.6</b> Reprojecting raster geometries</a></li>
<li class="chapter" data-level="6.7" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#exercises-4"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="read-write.html"><a href="read-write.html"><i class="fa fa-check"></i><b>7</b> Geographic data I/O</a><ul>
<li class="chapter" data-level="" data-path="read-write.html"><a href="read-write.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="7.1" data-path="read-write.html"><a href="read-write.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="read-write.html"><a href="read-write.html#retrieving-data"><i class="fa fa-check"></i><b>7.2</b> Retrieving open data</a></li>
<li class="chapter" data-level="7.3" data-path="read-write.html"><a href="read-write.html#geographic-data-packages"><i class="fa fa-check"></i><b>7.3</b> Geographic data packages</a></li>
<li class="chapter" data-level="7.4" data-path="read-write.html"><a href="read-write.html#file-formats"><i class="fa fa-check"></i><b>7.4</b> File formats</a></li>
<li class="chapter" data-level="7.5" data-path="read-write.html"><a href="read-write.html#data-input"><i class="fa fa-check"></i><b>7.5</b> Data Input (I)</a><ul>
<li class="chapter" data-level="7.5.1" data-path="read-write.html"><a href="read-write.html#vector-data-1"><i class="fa fa-check"></i><b>7.5.1</b> Vector data</a></li>
<li class="chapter" data-level="7.5.2" data-path="read-write.html"><a href="read-write.html#raster-data-1"><i class="fa fa-check"></i><b>7.5.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="read-write.html"><a href="read-write.html#data-output"><i class="fa fa-check"></i><b>7.6</b> Data output (O)</a><ul>
<li class="chapter" data-level="7.6.1" data-path="read-write.html"><a href="read-write.html#vector-data-2"><i class="fa fa-check"></i><b>7.6.1</b> Vector data</a></li>
<li class="chapter" data-level="7.6.2" data-path="read-write.html"><a href="read-write.html#raster-data-2"><i class="fa fa-check"></i><b>7.6.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="read-write.html"><a href="read-write.html#visual-outputs"><i class="fa fa-check"></i><b>7.7</b> Visual outputs</a></li>
<li class="chapter" data-level="7.8" data-path="read-write.html"><a href="read-write.html#exercises-5"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Extensions</b></span></li>
<li class="chapter" data-level="8" data-path="adv-map.html"><a href="adv-map.html"><i class="fa fa-check"></i><b>8</b> Making maps with R</a><ul>
<li class="chapter" data-level="" data-path="adv-map.html"><a href="adv-map.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="8.1" data-path="adv-map.html"><a href="adv-map.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="adv-map.html"><a href="adv-map.html#static-maps"><i class="fa fa-check"></i><b>8.2</b> Static maps</a><ul>
<li class="chapter" data-level="8.2.1" data-path="adv-map.html"><a href="adv-map.html#tmap-basics"><i class="fa fa-check"></i><b>8.2.1</b> tmap basics</a></li>
<li class="chapter" data-level="8.2.2" data-path="adv-map.html"><a href="adv-map.html#map-obj"><i class="fa fa-check"></i><b>8.2.2</b> Map objects</a></li>
<li class="chapter" data-level="8.2.3" data-path="adv-map.html"><a href="adv-map.html#aesthetics"><i class="fa fa-check"></i><b>8.2.3</b> Aesthetics</a></li>
<li class="chapter" data-level="8.2.4" data-path="adv-map.html"><a href="adv-map.html#color-settings"><i class="fa fa-check"></i><b>8.2.4</b> Color settings</a></li>
<li class="chapter" data-level="8.2.5" data-path="adv-map.html"><a href="adv-map.html#layouts"><i class="fa fa-check"></i><b>8.2.5</b> Layouts</a></li>
<li class="chapter" data-level="8.2.6" data-path="adv-map.html"><a href="adv-map.html#faceted-maps"><i class="fa fa-check"></i><b>8.2.6</b> Faceted maps</a></li>
<li class="chapter" data-level="8.2.7" data-path="adv-map.html"><a href="adv-map.html#inset-maps"><i class="fa fa-check"></i><b>8.2.7</b> Inset maps</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="adv-map.html"><a href="adv-map.html#animated-maps"><i class="fa fa-check"></i><b>8.3</b> Animated maps</a></li>
<li class="chapter" data-level="8.4" data-path="adv-map.html"><a href="adv-map.html#interactive-maps"><i class="fa fa-check"></i><b>8.4</b> Interactive maps</a></li>
<li class="chapter" data-level="8.5" data-path="adv-map.html"><a href="adv-map.html#mapping-applications"><i class="fa fa-check"></i><b>8.5</b> Mapping applications</a></li>
<li class="chapter" data-level="8.6" data-path="adv-map.html"><a href="adv-map.html#other-mapping-packages"><i class="fa fa-check"></i><b>8.6</b> Other mapping packages</a></li>
<li class="chapter" data-level="8.7" data-path="adv-map.html"><a href="adv-map.html#exercises-6"><i class="fa fa-check"></i><b>8.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="gis.html"><a href="gis.html"><i class="fa fa-check"></i><b>9</b> Bridges to GIS software</a><ul>
<li class="chapter" data-level="" data-path="gis.html"><a href="gis.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="9.1" data-path="gis.html"><a href="gis.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="gis.html"><a href="gis.html#rqgis"><i class="fa fa-check"></i><b>9.2</b> (R)QGIS</a></li>
<li class="chapter" data-level="9.3" data-path="gis.html"><a href="gis.html#rsaga"><i class="fa fa-check"></i><b>9.3</b> (R)SAGA</a></li>
<li class="chapter" data-level="9.4" data-path="gis.html"><a href="gis.html#rgrass"><i class="fa fa-check"></i><b>9.4</b> GRASS through <strong>rgrass7</strong></a></li>
<li class="chapter" data-level="9.5" data-path="gis.html"><a href="gis.html#when-to-use-what"><i class="fa fa-check"></i><b>9.5</b> When to use what?</a></li>
<li class="chapter" data-level="9.6" data-path="gis.html"><a href="gis.html#other-bridges"><i class="fa fa-check"></i><b>9.6</b> Other bridges</a><ul>
<li class="chapter" data-level="9.6.1" data-path="gis.html"><a href="gis.html#gdal"><i class="fa fa-check"></i><b>9.6.1</b> Bridges to GDAL</a></li>
<li class="chapter" data-level="9.6.2" data-path="gis.html"><a href="gis.html#postgis"><i class="fa fa-check"></i><b>9.6.2</b> Bridges to spatial databases</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="gis.html"><a href="gis.html#exercises-7"><i class="fa fa-check"></i><b>9.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="algorithms.html"><a href="algorithms.html"><i class="fa fa-check"></i><b>10</b> Scripts, algorithms and functions</a><ul>
<li class="chapter" data-level="" data-path="algorithms.html"><a href="algorithms.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="10.1" data-path="algorithms.html"><a href="algorithms.html#intro-algorithms"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="algorithms.html"><a href="algorithms.html#scripts"><i class="fa fa-check"></i><b>10.2</b> Scripts</a></li>
<li class="chapter" data-level="10.3" data-path="algorithms.html"><a href="algorithms.html#geographic-algorithms"><i class="fa fa-check"></i><b>10.3</b> Geographic algorithms</a></li>
<li class="chapter" data-level="10.4" data-path="algorithms.html"><a href="algorithms.html#functions"><i class="fa fa-check"></i><b>10.4</b> Functions</a></li>
<li class="chapter" data-level="10.5" data-path="algorithms.html"><a href="algorithms.html#ex-algorithms"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-cv.html"><a href="spatial-cv.html"><i class="fa fa-check"></i><b>11</b> Statistical learning</a><ul>
<li class="chapter" data-level="" data-path="spatial-cv.html"><a href="spatial-cv.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="11.1" data-path="spatial-cv.html"><a href="spatial-cv.html#intro-cv"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="spatial-cv.html"><a href="spatial-cv.html#case-landslide"><i class="fa fa-check"></i><b>11.2</b> Case study: Landslide susceptibility</a></li>
<li class="chapter" data-level="11.3" data-path="spatial-cv.html"><a href="spatial-cv.html#conventional-model"><i class="fa fa-check"></i><b>11.3</b> Conventional modeling approach in R</a></li>
<li class="chapter" data-level="11.4" data-path="spatial-cv.html"><a href="spatial-cv.html#intro-cv"><i class="fa fa-check"></i><b>11.4</b> Introduction to (spatial) cross-validation</a></li>
<li class="chapter" data-level="11.5" data-path="spatial-cv.html"><a href="spatial-cv.html#spatial-cv-with-mlr"><i class="fa fa-check"></i><b>11.5</b> Spatial CV with <strong>mlr</strong></a><ul>
<li class="chapter" data-level="11.5.1" data-path="spatial-cv.html"><a href="spatial-cv.html#glm"><i class="fa fa-check"></i><b>11.5.1</b> Generalized linear model</a></li>
<li class="chapter" data-level="11.5.2" data-path="spatial-cv.html"><a href="spatial-cv.html#svm"><i class="fa fa-check"></i><b>11.5.2</b> Spatial tuning of machine-learning hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="spatial-cv.html"><a href="spatial-cv.html#conclusions"><i class="fa fa-check"></i><b>11.6</b> Conclusions</a></li>
<li class="chapter" data-level="11.7" data-path="spatial-cv.html"><a href="spatial-cv.html#exercises-8"><i class="fa fa-check"></i><b>11.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Applications</b></span></li>
<li class="chapter" data-level="12" data-path="transport.html"><a href="transport.html"><i class="fa fa-check"></i><b>12</b> Transportation</a><ul>
<li class="chapter" data-level="" data-path="transport.html"><a href="transport.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="12.1" data-path="transport.html"><a href="transport.html#introduction-7"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="transport.html"><a href="transport.html#bris-case"><i class="fa fa-check"></i><b>12.2</b> A case study of Bristol</a></li>
<li class="chapter" data-level="12.3" data-path="transport.html"><a href="transport.html#transport-zones"><i class="fa fa-check"></i><b>12.3</b> Transport zones</a></li>
<li class="chapter" data-level="12.4" data-path="transport.html"><a href="transport.html#desire-lines"><i class="fa fa-check"></i><b>12.4</b> Desire lines</a></li>
<li class="chapter" data-level="12.5" data-path="transport.html"><a href="transport.html#routes"><i class="fa fa-check"></i><b>12.5</b> Routes</a></li>
<li class="chapter" data-level="12.6" data-path="transport.html"><a href="transport.html#nodes"><i class="fa fa-check"></i><b>12.6</b> Nodes</a></li>
<li class="chapter" data-level="12.7" data-path="transport.html"><a href="transport.html#route-networks"><i class="fa fa-check"></i><b>12.7</b> Route networks</a></li>
<li class="chapter" data-level="12.8" data-path="transport.html"><a href="transport.html#prioritizing-new-infrastructure"><i class="fa fa-check"></i><b>12.8</b> Prioritizing new infrastructure</a></li>
<li class="chapter" data-level="12.9" data-path="transport.html"><a href="transport.html#future-directions-of-travel"><i class="fa fa-check"></i><b>12.9</b> Future directions of travel</a></li>
<li class="chapter" data-level="12.10" data-path="transport.html"><a href="transport.html#ex-transport"><i class="fa fa-check"></i><b>12.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="location.html"><a href="location.html"><i class="fa fa-check"></i><b>13</b> Geomarketing</a><ul>
<li class="chapter" data-level="" data-path="location.html"><a href="location.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="13.1" data-path="location.html"><a href="location.html#introduction-8"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="location.html"><a href="location.html#case-study"><i class="fa fa-check"></i><b>13.2</b> Case study: bike shops in Germany</a></li>
<li class="chapter" data-level="13.3" data-path="location.html"><a href="location.html#tidy-the-input-data"><i class="fa fa-check"></i><b>13.3</b> Tidy the input data</a></li>
<li class="chapter" data-level="13.4" data-path="location.html"><a href="location.html#create-census-rasters"><i class="fa fa-check"></i><b>13.4</b> Create census rasters</a></li>
<li class="chapter" data-level="13.5" data-path="location.html"><a href="location.html#define-metropolitan-areas"><i class="fa fa-check"></i><b>13.5</b> Define metropolitan areas</a></li>
<li class="chapter" data-level="13.6" data-path="location.html"><a href="location.html#points-of-interest"><i class="fa fa-check"></i><b>13.6</b> Points of interest</a></li>
<li class="chapter" data-level="13.7" data-path="location.html"><a href="location.html#identifying-suitable-locations"><i class="fa fa-check"></i><b>13.7</b> Identifying suitable locations</a></li>
<li class="chapter" data-level="13.8" data-path="location.html"><a href="location.html#discussion-and-next-steps"><i class="fa fa-check"></i><b>13.8</b> Discussion and next steps</a></li>
<li class="chapter" data-level="13.9" data-path="location.html"><a href="location.html#exercises-9"><i class="fa fa-check"></i><b>13.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="eco.html"><a href="eco.html"><i class="fa fa-check"></i><b>14</b> Ecology</a><ul>
<li class="chapter" data-level="" data-path="eco.html"><a href="eco.html#prerequisites-12"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="14.1" data-path="eco.html"><a href="eco.html#introduction-9"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="eco.html"><a href="eco.html#data-and-data-preparation"><i class="fa fa-check"></i><b>14.2</b> Data and data preparation</a></li>
<li class="chapter" data-level="14.3" data-path="eco.html"><a href="eco.html#nmds"><i class="fa fa-check"></i><b>14.3</b> Reducing dimensionality</a></li>
<li class="chapter" data-level="14.4" data-path="eco.html"><a href="eco.html#modeling-the-floristic-gradient"><i class="fa fa-check"></i><b>14.4</b> Modeling the floristic gradient</a><ul>
<li class="chapter" data-level="14.4.1" data-path="eco.html"><a href="eco.html#mlr-building-blocks"><i class="fa fa-check"></i><b>14.4.1</b> <strong>mlr</strong> building blocks</a></li>
<li class="chapter" data-level="14.4.2" data-path="eco.html"><a href="eco.html#predictive-mapping"><i class="fa fa-check"></i><b>14.4.2</b> Predictive mapping</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="eco.html"><a href="eco.html#conclusions-1"><i class="fa fa-check"></i><b>14.5</b> Conclusions</a></li>
<li class="chapter" data-level="14.6" data-path="eco.html"><a href="eco.html#exercises-10"><i class="fa fa-check"></i><b>14.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>15</b> Conclusion</a><ul>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html#prerequisites-13"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="15.1" data-path="conclusion.html"><a href="conclusion.html#gaps"><i class="fa fa-check"></i><b>15.1</b> Gaps and overlaps</a></li>
<li class="chapter" data-level="15.2" data-path="conclusion.html"><a href="conclusion.html#next"><i class="fa fa-check"></i><b>15.2</b> Where next?</a></li>
<li class="chapter" data-level="15.3" data-path="conclusion.html"><a href="conclusion.html#benefit"><i class="fa fa-check"></i><b>15.3</b> Geo* for social benefit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://robinlovelace.net/">Robin Lovelace</a></li>
<li><a href="https://nowosad.github.io/">Jakub Nowosad</a></li>
<li><a href="http://www.geographie.uni-jena.de/en/Muenchow.html">Jannes Muenchow</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Geocomputation with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-class" class="section level1">
<h1><span class="header-section-number">2</span> Geographic data in R</h1>
<div id="prerequisites" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<p>This is the first practical chapter of the book, and therefore it comes with some software requirements.
We assume that you have an up-to-date version of R installed and that you are comfortable using software with a command-line interface such as the integrated development environment (IDE) RStudio.</p>
<p>If you are new to R, we recommend reading Chapter 2 of the free online book <em>Efficient R Programming</em> <span class="citation">Gillespie and Lovelace (<a href="#ref-gillespie_efficient_2016">2016</a>)</span>, particularly sections 2.3 and 2.5, for details on R installation and <a href="https://csgillespie.github.io/efficientR/set-up.html">set-up</a>.
It is also worth learning the basics of the language, using resources such as <span class="citation">Gillespie and Lovelace (<a href="#ref-gillespie_efficient_2016">2016</a>)</span>, <span class="citation">Grolemund and Wickham (<a href="#ref-grolemund_r_2016">2016</a>)</span> or interactive guides such as <a href="https://www.datacamp.com/courses/free-introduction-to-r">DataCamp</a> before proceeding.
We recommend organizing your work as you learn with RStudio projects and clearly named script files (such as <code>chapter-02.R</code> for example) containing code you have typed (not copy-pasted!) as you learn.</p>
<!-- '[project](https://csgillespie.github.io/efficientR/set-up.html#project-management)' called `geocomp-learning`. -->
<!--     Creating new script for each chapter or section of interest will help consolidate and extend the skills learned. -->
<!--     The code you type to help learn the content of this chapter could be placed in a file called `chapter-02.R`, for example. -->
<!--     Everyone learns in a different way; structure your work so it makes sense to you; and avoid copy-pasting to get used to typing code. -->
<!-- Another option is to use the RStudio project provided in the root directory of the [`geocompr`](https://github.com/Robinlovelace/geocompr) GitHub repository. -->
<!-- This will make it easier to run this book's worked examples on your computer. -->
<p>After you’ve checked you R installation and brushed-up on your R skills where appropriate, the next step is to install and load the packages used in this chapter.
Packages are installed with the <code>install.packages()</code> function which can be used to get the prerequisites on your computer:<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</a></code></pre></div>

<div class="rmdnote">
If you’re running Mac or Linux the previous command to install <strong>sf</strong> may not workfirst time.
A few ‘systems requirements’ must be installed, described in the package’s README at <a href="https://github.com/r-spatial/sf">github.com/r-spatial/sf</a>.
For users of Ubuntu 18.04 the steps are covered in detail in an article on <a href="https://rtask.thinkr.fr/blog/installation-of-r-3-5-on-ubuntu-18-04-lts-and-tips-for-spatial-packages/">thinkr.fr</a>.
</div>

<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;raster&quot;</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="st">&quot;spData&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">install.packages</span>(<span class="st">&quot;spDataLarge&quot;</span>, <span class="dt">repos =</span> <span class="st">&quot;https://nowosad.github.io/drat/&quot;</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                 <span class="dt">type =</span> <span class="st">&quot;source&quot;</span>)</a></code></pre></div>
<p>To install these packages and <em>all other</em> packages used in this book in one go, you can use the following command, which requires the <strong>devtools</strong> package: <code>devtools::install_github(&quot;geocompr/geocompkg&quot;)</code>.
After the necessary packages have been installed, they can be ‘loaded’ (technically they are attached) with <code>library()</code> as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(sf)          <span class="co"># classes and functions for vector data</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">library</span>(raster)      <span class="co"># classes and functions for raster data</span></a></code></pre></div>
<p>The other packages that were installed contain data that will be used in the book:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">library</span>(spData)        <span class="co"># load geographic data</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">library</span>(spDataLarge)   <span class="co"># load larger geographic data</span></a></code></pre></div>
<p>This chapter will provide brief explanations of the fundamental geographic data models: vector and raster.
We will introduce the theory behind each data model and the disciplines in which they predominate, before demonstrating their implementation in R.
<!-- Vector and raster models are vital to geospatial analysis [@longley_geographic_2015]. --></p>
<p>The <em>vector data model</em> represents the world using points, lines and polygons.
These have discrete, well-defined borders, meaning that vector datasets usually have a high level of precision (but not necessarily accuracy as we will see in <a href="spatial-class.html#units">2.4</a>).
The <em>raster data model</em> divides the surface up into cells of constant size.
Raster datasets are the basis of background images used in web-mapping and have been a vital source of geographic data since the origins of aerial photography and satellite-based remote sensing devices.
Rasters aggregate spatially specific features to a given resolution, meaning that they are consistent over space and scalable (many worldwide raster datasets are available).
<!-- The downside of this is that small features can be blurred or lost. (commented - too specific) -->
<!-- todo: add figure(s) showing raster data and blurring? --></p>
<p>Which to use?
The answer likely depends on your domain of application:</p>
<ul>
<li>Vector data tends to dominate the social sciences because human settlements tend to have discrete borders.</li>
<li>Raster often dominates in environmental sciences because of the reliance on remote sensing data.</li>
</ul>
<p>There is much overlap in some fields and raster and vector datasets can be used together:
ecologists and demographers, for example, commonly use both vector and raster data.
Furthermore, it is possible to convert between the two forms (see section <a href="geometric-operations.html#raster-vector">5.4</a>).
Whether your work involves more use of vector or raster datasets, it is worth understanding the underlying data model before using them, as discussed in subsequent chapters.
This book uses <strong>sf</strong> and <strong>raster</strong> packages to work with vector data and raster datasets respectively.</p>
</div>
<div id="vector-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Vector data</h2>

<div class="rmdnote">
Take care when using the word ‘vector’ as it can have two meanings in this book:
geographic vector data and the <code>vector</code> class (note the <code>monospace</code> font) in R.
The former is a data model, the latter is an R class just like <code>data.frame</code> and <code>matrix</code>.
Still, there is a link between the two: the spatial coordinates which are at the heart of the geographic vector data model can be represented in R using <code>vector</code> objects.
</div>

<p>The geographic vector model is based on points located within a coordinate reference system (CRS).
Points can represent self-standing features (e.g. the location of a bus stop) or they can be linked together to form more complex geometries such as lines and polygons.
Most point geometries contain only two dimensions (3 dimensional CRSs contain an additional <span class="math inline">\(z\)</span> value, typically representing height above sea level).</p>
<p>In this system London, for example, can be represented by the coordinates <code>c(-0.1, 51.5)</code>.
This means that its location is -0.1 degrees east and 51.5 degrees north of the origin.
The origin in this case is at 0 degrees longitude (the Prime Meridian) and 0 degree latitude (the Equator) in a geographic (‘lon/lat’) CRS (Figure <a href="spatial-class.html#fig:vectorplots">2.1</a>, left panel).
The same point could also be approximated in a projected CRS with ‘Easting/Northing’ values of <code>c(530000, 180000)</code> in the British National Grid (<a href="https://en.wikipedia.org/wiki/Ordnance_Survey_National_Grid">BNG</a>), meaning that London is located 530 km <em>East</em> and 180 km <em>North</em> of the <span class="math inline">\(origin\)</span> of the CRS.
This can be verified visually: slightly more than 5 ‘boxes’ — square areas bounded by the gray grid lines 100 km in width — separate the point representing London from the origin (Figure <a href="spatial-class.html#fig:vectorplots">2.1</a>, right panel).</p>
<p>The location of BNG’s origin, in the sea beyond South West Peninsular, ensures that most locations in the UK have positive Easting and Northing values.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>
There is more to CRSs, as described in sections <a href="spatial-class.html#crs-intro">2.3</a> and <a href="reproj-geo-data.html#reproj-geo-data">6</a> but, for the purposes of this section, it is sufficient to know that coordinates consist of two numbers representing distance from an origin, usually in <span class="math inline">\(x\)</span> then <span class="math inline">\(y\)</span> dimensions.</p>
<div class="figure" style="text-align: center"><span id="fig:vectorplots"></span>
<img src="figures/vector_lonlat.png" alt="Illustration of vector (point) data in which location of London (the red X) is represented with reference to an origin (the blue circle). The left plot represents a geographic CRS with an origin at 0° longitude and latitude. The right plot represents a projected CRS with an origin located in the sea west of the South West Peninsula." width="49%" /><img src="figures/vector_projected.png" alt="Illustration of vector (point) data in which location of London (the red X) is represented with reference to an origin (the blue circle). The left plot represents a geographic CRS with an origin at 0° longitude and latitude. The right plot represents a projected CRS with an origin located in the sea west of the South West Peninsula." width="49%" />
<p class="caption">
Figure 2.1: Illustration of vector (point) data in which location of London (the red X) is represented with reference to an origin (the blue circle). The left plot represents a geographic CRS with an origin at 0° longitude and latitude. The right plot represents a projected CRS with an origin located in the sea west of the South West Peninsula.
</p>
</div>
<p><strong>sf</strong> is a package providing a class system for geographic vector data.
Not only does it supercede <strong>sp</strong> it also provides a consistent command-line interface to GEOS and GDAL, superceding <strong>rgeos</strong> and <strong>rgdal</strong> (described in section <a href="intro.html#the-history-of-r-spatial">1.5</a>).
<!-- Really? not necessary so removed (RL) -->
<!-- In theory this should make **sf** faster than **sp**/**rgdal**/**rgeos**. -->
This section introduces <strong>sf</strong> classes in preparation for subsequent chapters (Chapters <a href="geometric-operations.html#geometric-operations">5</a> and <a href="read-write.html#read-write">7</a> cover the GEOS and GDAL interface respectively).</p>
<!-- Commented out: not really necessary here - keeping as could be useful elsewhere: -->
<!-- In mathematical notation these points are typically represented as numbers separated by commas and enclosed by a pair of brackets:  -->
<!-- $(1, 3)$ for example, represents a point located one unit to the right and three units above the origin. -->
<!-- Instead of creating these points manually, one would commonly read-in data with functions such as `read_csv()` from the **tidyverse** or `read_sf()` from the **sf** package (see chapter \@ref(read-write)). -->
<!-- To generate new data (e.g., for testing), one can use the command `c()` (think of 'c' for 'combine'), as illustrated -->
<!-- below:^[Other methods for generating numbers include with the `seq()` function (short for 'sequence') for generating regular sequences or `runif()`, `rnorm()` and other functions generating random numbers following some kind of probability distribution. -->
<!-- The **mapedit** package can be used to create spatial data manually on an interactive map. -->
<!-- ] -->
<!-- ```{r} -->
<!-- p = c(1, 3) -->
<!-- ``` -->
<!-- Now this can be plotted in Cartesian space, as illustrated in figure \@ref(fig:cartesian): -->
<!-- ```{r cartesian, fig.cap="Illustration of vector point data in base R."} -->
<!-- plot(x = p[1], y = p[2], xlim =  c(0, 5), ylim = c(0, 5)) -->
<!-- ``` -->
<div id="intro-sf" class="section level3">
<h3><span class="header-section-number">2.1.1</span> An introduction to simple features</h3>
<p>Simple features is an <a href="http://portal.opengeospatial.org/files/?artifact_id=25355">open standard</a> developed and endorsed by the Open Geospatial Consortium (OGC), a not-for-profit organization whose activities we will revisit in a later chapter (in section <a href="read-write.html#file-formats">7.4</a>).
Simple Features is a hierarchical data model that represents a wide range of geometry types.
Of 68 geometry types supported by the specification, only 7 are used in the vast majority of geographic research (see Figure <a href="spatial-class.html#fig:sf-ogc">2.2</a>);
these core geometry types are fully supported by R package <strong>sf</strong> <span class="citation">(E. Pebesma <a href="#ref-pebesma_simple_2018">2018</a>)</span>.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<div class="figure" style="text-align: center"><span id="fig:sf-ogc"></span>
<img src="figures/sf-classes.png" alt="The subset of the Simple Features class hierarchy supported by sf." width="60%" />
<p class="caption">
Figure 2.2: The subset of the Simple Features class hierarchy supported by sf.
</p>
</div>
<p><strong>sf</strong> can represent all common vector geometry types (raster data classes are not supported by <strong>sf</strong>): points, lines, polygons and their respective ‘multi’ versions (which group together features of the same type into a single feature).
<strong>sf</strong> also supports geometry collections, which can contain multiple geometry types in a single object.
Given the breadth of geographic data forms, it may come as a surprise that a class system to support all of them is provided in a single package, which can be installed from CRAN:<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>
<strong>sf</strong> incorporates the functionality of the three main packages of the <strong>sp</strong> paradigm, <strong>sp</strong> <span class="citation">(E. Pebesma and Bivand <a href="#ref-R-sp">2018</a>)</span> for the class system, <strong>rgdal</strong> <span class="citation">(Bivand, Keitt, and Rowlingson <a href="#ref-R-rgdal">2018</a>)</span> for reading and writing data, <strong>rgeos</strong> <span class="citation">(Bivand and Rundel <a href="#ref-R-rgeos">2018</a>)</span> for spatial operations undertaken by GEOS, in a single, cohesive whole.
This is well-documented in <strong>sf</strong>’s <a href="http://cran.rstudio.com/package=sf">vignettes</a>.</p>
<p>As the first vignette explains, simple feature objects in R are stored in a data frame, with geographic data occupying a special column, a ‘list-column’. This column is usually named ‘geom’ or ‘geometry’.
We will use the <code>world</code> dataset provided by the <strong>spData</strong>, loaded at the beginning of this chapter (see <a href="https://nowosad.github.io/spData/">nowosad.github.io/spData</a> for a list datasets loaded by the package).
<code>world</code> is a spatial object containing spatial and attribute columns, the names of which are returned by the function <code>names()</code> (the last column contains the geographic information):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">names</span>(world)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;  [1] &quot;iso_a2&quot;    &quot;name_long&quot; &quot;continent&quot; &quot;region_un&quot; &quot;subregion&quot;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;  [6] &quot;type&quot;      &quot;area_km2&quot;  &quot;pop&quot;       &quot;lifeExp&quot;   &quot;gdpPercap&quot;</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [11] &quot;geom&quot;</span></a></code></pre></div>
<p>It is the contents of this modest-looking <code>geom</code> column that gives <code>sf</code> objects their spatial powers, a ‘list-column’ that contains all the coordinates.
The <strong>sf</strong> package provides a <code>plot()</code> method for visualizing geographic data:
the follow command creates Figure <a href="spatial-class.html#fig:world-all">2.3</a>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">plot</span>(world)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:world-all"></span>
<img src="figures/world-all-1.png" alt="A spatial plot of the world using the sf package, with a facet for each attribute." width="576" />
<p class="caption">
Figure 2.3: A spatial plot of the world using the sf package, with a facet for each attribute.
</p>
</div>
<p>Note that instead of creating a single map, as most GIS programs would, the <code>plot()</code> command has created multiple maps, one for each variable in the <code>world</code> datasets.
This behavior can be useful for exploring the spatial distribution of different variables and is discussed further in <a href="spatial-class.html#basic-map">2.1.3</a> below.</p>
<p>Being able to treat spatial objects as regular data frames with spatial powers has many advantages, especially if you are already used to working with data frames.
The commonly used <code>summary()</code> function, for example, provides a useful overview of the variables within the <code>world</code> object.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">summary</span>(world[<span class="st">&quot;lifeExp&quot;</span>])</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;     lifeExp                geom    </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;  Min.   :50.6   MULTIPOLYGON :177  </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;  1st Qu.:65.0   epsg:4326    :  0  </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;  Median :72.9   +proj=long...:  0  </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;  Mean   :70.9                      </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;  3rd Qu.:76.8                      </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  Max.   :83.6                      </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  NA&#39;s   :10</span></a></code></pre></div>
<p>Although we have only selected one variable for the <code>summary</code> command, it also outputs a report on the geometry.
This demonstrates the ‘sticky’ behavior of the geometry columns of <strong>sf</strong> objects, meaning the geometry is kept unless the user deliberately removes them, as we’ll see in section <a href="attr.html#vector-attribute-manipulation">3.2</a>.
The result provides a quick summary of both the non-spatial and spatial data contained in <code>world</code>: the mean average life expectancy is 71 years (ranging from less than 50 to more than 80 years with a median of 73 years) across all countries.</p>

<div class="rmdnote">
The word <code>MULTIPOLYGON</code> in the summary output above refers to the geometry type of features (countries) in the <code>world</code> object.
This representation is necessary for countries with islands such as Indonesia and Greece.
Other geometry types are described in section <a href="spatial-class.html#geometry">2.1.5</a>.
</div>

<!-- TODO: cross-reference section covering CRSs. -->
<p>It is worth taking a deeper look at the basic behavior and contents of this simple feature object, which can usefully be thought of as a ’<strong>S</strong>patial data<strong>F</strong>rame).</p>
<p><code>sf</code> objects are easy to subset.
The code below shows its first two rows and three columns.
The output shows two major differences compared with a regular <code>data.frame</code>: the inclusion of additional geographic data (<code>geometry type</code>, <code>dimension</code>, <code>bbox</code> and CRS information - <code>epsg (SRID)</code>, <code>proj4string</code>), and the presence of final <code>geometry</code> column:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">world[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; Simple feature collection with 2 features and 3 fields</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; dimension:      XY</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; bbox:           xmin: -180 ymin: -18.3 xmax: 180 ymax: -0.95</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; epsg (SRID):    4326</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;   iso_a2 name_long continent                           geom</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; 1     FJ      Fiji   Oceania MULTIPOLYGON (((180 -16.1, ...</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; 2     TZ  Tanzania    Africa MULTIPOLYGON (((33.9 -0.95,...</span></a></code></pre></div>
<p>All this may seem rather complex, especially for a class system that is supposed to be simple.
However, there are good reasons for organizing things this way and using <strong>sf</strong>.</p>
<!-- It's a `MULTIPOLYGON` with 177 features and a geographic (longitude/latidue) coordinate reference system (CRS) with an EPSG code of `4326`. -->
<!-- ### Simple feature classes {#sf-classes} -->
<!-- This section shows how vector spatial classes are created. -->
<p>Before describing each geometry type that the <strong>sf</strong> package supports, it is worth taking a step back to understand the building blocks of <code>sf</code> objects.
Section <a href="spatial-class.html#sf">2.1.8</a> shows how simple features objects are data frames, with special geometry columns.
These spatial columns are often called <code>geom</code> or <code>geometry</code>: <code>world$geom</code> refers to the spatial element of the <code>world</code> object described above.
These geometry columns are ‘list columns’ of class <code>sfc</code> (see section <a href="spatial-class.html#sfc">2.1.7</a>).
In turn, <code>sfc</code> objects are composed of one or more objects of class <code>sfg</code>: simple feature geometries that we describe in section <a href="spatial-class.html#sfg">2.1.6</a>.</p>
<p>To understand how the spatial components of simple features work, it is vital to understand simple feature geometries.
For this reason we cover each currently supported simple features geometry types in the section <a href="spatial-class.html#geometry">2.1.5</a> before moving on to describe how these can be represented in R using <code>sfg</code> objects, combined to form <code>sfc</code> and eventually full <code>sf</code> objects.</p>
</div>
<div id="why-simple-features" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Why simple features?</h3>
<p>Simple features is a widely supported data model that underlies data structures in many GIS applications including QGIS and PostGIS.
A major advantage of this is that using the data model ensures your work is cross-transferable to other set-ups, for example importing from and exporting to spatial databases.</p>
<p>A more specific question from an R perspective is “why use the <strong>sf</strong> package when <strong>sp</strong> is already tried and tested”?
There are many reasons (linked to the advantages of the simple features model) including:</p>
<ul>
<li>Fast reading and writing of data</li>
<li>Enhanced plotting performance</li>
<li><strong>sf</strong> objects can be treated as data frames in most operations</li>
<li><strong>sf</strong> functions can be combined using <code>%&gt;%</code> operator and works well with the <a href="http://tidyverse.org/">tidyverse</a> collection of R packages</li>
<li><strong>sf</strong> function names are relatively consistent and intuitive (all begin with <code>st_</code>)</li>
</ul>
<p>Due to such advantages some spatial packages (including <strong>tmap</strong>, <strong>mapview</strong> and <strong>tidycensus</strong>) have added support for <strong>sf</strong>.
However, it will take many years for most packages to transition and some will never switch.
Fortunately these can still be used in a workflow based on <code>sf</code> objects, by converting them to the <code>Spatial</code> class used in <strong>sp</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">world_sp =<span class="st"> </span><span class="kw">as</span>(world, <span class="dt">Class =</span> <span class="st">&quot;Spatial&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># sp functions ...</span></a></code></pre></div>
<p><code>Spatial</code> objects can be converted back to <code>sf</code> in the same way or with <code>st_as_sf()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">world_sf =<span class="st"> </span><span class="kw">st_as_sf</span>(world_sp, <span class="st">&quot;sf&quot;</span>)</a></code></pre></div>
</div>
<div id="basic-map" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Basic map making</h3>
<p>Basic maps are created in <strong>sf</strong> with <code>plot()</code>.
By default this creates a multi-panel plot (like <strong>sp</strong>’s <code>spplot()</code>), one sub-plot for each variable of the object, as illustrated in the left-hand panel in Figure <a href="spatial-class.html#fig:sfplot">2.4</a>.
A legend or ‘key’ with a continuous color is produced if the object to be plotted has a single variable (see the right-hand panel).
Colors can also be set with <code>col =</code>, although this will not create a continuous palette or a legend.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">plot</span>(world[<span class="dv">3</span><span class="op">:</span><span class="dv">6</span>])</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">plot</span>(world[<span class="st">&quot;pop&quot;</span>])</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:sfplot"></span>
<img src="figures/sfplot-1.png" alt="Plotting with sf, with multiple variables (left) and a single variable (right)." width="49%" /><img src="figures/sfplot-2.png" alt="Plotting with sf, with multiple variables (left) and a single variable (right)." width="49%" />
<p class="caption">
Figure 2.4: Plotting with sf, with multiple variables (left) and a single variable (right).
</p>
</div>
<p>Plots are added as layers to existing images by setting <code>add = TRUE</code>.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>
To demonstrate this, and to provide a taster of content covered in chapters <a href="attr.html#attr">3</a> and <a href="spatial-operations.html#spatial-operations">4</a> on attribute and spatial data operations, the subsequent code chunk combines countries in Asia:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">asia =<span class="st"> </span>world[world<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>, ]</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">asia =<span class="st"> </span><span class="kw">st_union</span>(asia)</a></code></pre></div>
<p>We can now plot the Asian continent over a map of the world.
Note that the first plot must only have one facet for <code>add = TRUE</code> to work.
If the first plot has a key, <code>reset = FALSE</code> must be used (result not shown):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">plot</span>(world[<span class="st">&quot;pop&quot;</span>], <span class="dt">reset =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">plot</span>(asia, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p>Adding layers in this way can be used to verify the geographic correspondence between layers:
the <code>plot()</code> function is fast to execute and requires few lines of code, but does not create interactive maps with a wide range of options.
For more advanced map making we recommend using dedicated visualization packages such as <strong>tmap</strong> (see Chapter <a href="adv-map.html#adv-map">8</a>).</p>
<!-- 
- plot() function 
- map export 
-->
<!-- Maybe show also somewhere that `world[0]` produces only a plot of the geometry which is rather useful if you do not want to plot a specific attribute. This way, you can for example dismiss the col = "white"-argument in your Nigeria example.
Sorry for commenting on this again but just to clarify africa[0] selects zero columns but since the geometry column is sticky it won't be dismissed. Nevertheless, to be more explicit one should probably use plot(st_geometry(africa))-->
</div>
<div id="base-args" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Base plot arguments</h3>
<p>Advanced map making is covered in detail in Chapter <a href="adv-map.html#adv-map">8</a>.
However, it is worth knowing how to modify plots using the <strong>sf</strong> package for quick and flexible visualization.
Because <strong>sf</strong> extends base R plotting methods <code>plot()</code>’s arguments such as <code>main =</code> — which specifies the title of the map — work with <code>sf</code> objects (see <code>?graphics::plot</code> and <code>?par</code>).<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<p>Figure <a href="spatial-class.html#fig:contpop">2.5</a> illustrates this flexibility by overlaying circles, whose diameters (set with <code>cex =</code>) represent country populations, on a map of the world.
A basic version of the map can be created with the following commands (see exercises at the end of this chapter and the script <a href="https://github.com/Robinlovelace/geocompr/blob/master/code/02-contpop.R"><code>02-contplot.R</code></a> to create Figure <a href="spatial-class.html#fig:contpop">2.5</a>):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">plot</span>(world[<span class="st">&quot;continent&quot;</span>], <span class="dt">reset =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">cex =<span class="st"> </span><span class="kw">sqrt</span>(world<span class="op">$</span>pop) <span class="op">/</span><span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">world_cents =<span class="st"> </span><span class="kw">st_centroid</span>(world, <span class="dt">of_largest =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(world_cents), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">cex =</span> cex)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:contpop"></span>
<img src="figures/contpop-1.png" alt="Country continents (represented by fill color) and 2015 populations (represented by circles, with area proportional to population)." width="576" />
<p class="caption">
Figure 2.5: Country continents (represented by fill color) and 2015 populations (represented by circles, with area proportional to population).
</p>
</div>
<p>The code above uses the function <code>st_centroid()</code> to convert one geometry type (polygon) to another (point).
Here is not the place to explain how the function works (this is covered in Chapter <a href="geometric-operations.html#geometric-operations">5</a>).
The point is that simple feature geometries can come in different forms, the topic of the next sections.</p>
</div>
<div id="geometry" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Geometry types</h3>
<!-- This section demonstrates how the full range of geometry types supported by the **sf** package can be created, combined and plotted. -->
<p>Geometries are the basic building blocks of simple features.
Simple features in R can take on one of the 17 geometry types supported by the <strong>sf</strong> package.
In this chapter we will focus on the seven most commonly used types: <code>POINT</code>, <code>LINESTRING</code>, <code>POLYGON</code>, <code>MULTIPOINT</code>, <code>MULTILINESTRING</code>, <code>MULTIPOLYGON</code> and <code>GEOMETRYCOLLECTION</code>.<!--FIG-->
Find the whole list of possible feature types in <a href="http://postgis.net/docs/using_postgis_dbmanagement.html">the PostGIS manual</a>.</p>
<p>Generally, well-known binary (WKB) or well-known text (WKT) are the standard encoding for simple feature geometries.
WKB representations are usually hexadecimal strings easily readable for computers.
This is why GIS and spatial databases use WKB to transfer and store geometry objects.
WKT, on the other hand, is a human-readable text markup description of simple features.
Both formats are exchangeable, and if we present one, we will naturally choose the WKT representation.</p>
<p>The basis for each geometry type is the point.
A point is simply a coordinate in 2D, 3D or 4D space (see <code>vignette(&quot;sf1&quot;)</code> for more information) such as (see left panel in Figure <a href="spatial-class.html#fig:sfcs">2.6</a>):</p>
<ul>
<li><code>POINT (5 2)</code></li>
</ul>
<p>A linestring is a sequence of points with a straight line connecting the points, for example (see middle panel in Figure <a href="spatial-class.html#fig:sfcs">2.6</a>):</p>
<ul>
<li><code>LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)</code></li>
</ul>
<p>A polygon is a sequence of points that form a closed, non-intersecting ring.
Closed means that the first and the last point of a polygon have the same coordinates (see right panel in Figure <a href="spatial-class.html#fig:sfcs">2.6</a>).<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<ul>
<li>Polygon without a hole - <code>POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5))</code></li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:sfcs"></span>
<img src="figures/sfcs-1.png" alt="Illustration of point, linestring and polygon geometries." width="576" />
<p class="caption">
Figure 2.6: Illustration of point, linestring and polygon geometries.
</p>
</div>
<p>So far we have created geometries with only one geometric entity per feature.
However, <strong>sf</strong> also allows multiple geometries to exist within a single feature (hence the term ‘geometry collection’) using “multi” version of each geometry type:</p>
<ul>
<li>Multipoint - <code>MULTIPOINT (5 2, 1 3, 3 4, 3 2)</code></li>
<li>Multistring - <code>MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4))</code></li>
<li>Multipolygon - <code>MULTIPOLYGON (((1 5, 2 2, 4 1, 4 4, 1 5), (0 2, 1 2, 1 3, 0 3, 0 2)))</code></li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:multis"></span>
<img src="figures/multis-1.png" alt="Illustration of multipoint, mutlilinestring and multipolygon geometries." width="576" />
<p class="caption">
Figure 2.7: Illustration of multipoint, mutlilinestring and multipolygon geometries.
</p>
</div>
<p>Finally, a geometrycollection might contain any combination of geometries including (multi)points and linestrings (see Figure <a href="spatial-class.html#fig:geomcollection">2.8</a>):</p>
<ul>
<li>Geometry collection - <code>GEOMETRYCOLLECTION (MULTIPOINT (5 2, 1 3, 3 4, 3 2), LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2))</code></li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:geomcollection"></span>
<img src="figures/geomcollection-1.png" alt="Illustration of geometry collection." width="33%" />
<p class="caption">
Figure 2.8: Illustration of geometry collection.
</p>
</div>
</div>
<div id="sfg" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Simple feature geometries (sfg)</h3>
<p>The <code>sfg</code> class represents the different simple feature geometry types: point, linestring, polygon (and their ‘multi’ equivalents, such as multipoints) or geometry collection.</p>
<p>Usually you are spared the tedious task of creating geometries on your own since you can simply import an already existing spatial file.
However, there are a set of functions to create simple feature geometry objects (<code>sfg</code>) from scratch if needed.
The names of these functions are simple and consistent, as they all start with the <code>st_</code> prefix and end with the name of the geometry type in lowercase letters:</p>
<ul>
<li>A point - <code>st_point()</code></li>
<li>A linestring - <code>st_linestring()</code></li>
<li>A polygon - <code>st_polygon()</code></li>
<li>A multipoint - <code>st_multipoint()</code></li>
<li>A multilinestring - <code>st_multilinestring()</code></li>
<li>A multipolygon - <code>st_multipolygon()</code></li>
<li>A geometry collection - <code>st_geometrycollection()</code></li>
</ul>
<p><code>sfg</code> objects can be created from three native data types:</p>
<ol style="list-style-type: decimal">
<li>A numeric vector - a single point</li>
<li>A matrix - a set of points, where each row contains a point - a multipoint or linestring</li>
<li>A list - any other set, e.g. a multilinestring or geometry collection</li>
</ol>
<p>To create point objects, we use the <code>st_point()</code> function in conjunction with a numeric vector:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># note that we use a numeric vector for points</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)) <span class="co"># XY point</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; POINT (5 2)</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="co"># XYZ point</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt; POINT Z (5 2 3)</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">dim =</span> <span class="st">&quot;XYM&quot;</span>) <span class="co"># XYM point</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; POINT M (5 2 1)</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)) <span class="co"># XYZM point</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; POINT ZM (5 2 3 1)</span></a></code></pre></div>
<!-- is this really important? -->
<p>XY, XYZ and XYZM types of points are automatically created based on the length of a numeric vector.
Only the XYM type needs to be specified using a <code>dim</code> argument.</p>
<p>By contrast, use matrices in the case of multipoint (<code>st_multipoint()</code>) and linestring (<code>st_linestring()</code>) objects:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># the rbind function simplifies the creation of matrices</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">## MULTIPOINT</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">multipoint_matrix =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="kw">st_multipoint</span>(multipoint_matrix)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; MULTIPOINT (5 2, 1 3, 3 4, 3 2)</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">## LINESTRING</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">linestring_matrix =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="kw">st_linestring</span>(linestring_matrix)</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)</span></a></code></pre></div>
<p>Finally, use lists for the creation of multilinestrings, (multi-)polygons and geometry collections:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">## POLYGON</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">polygon_list =<span class="st"> </span><span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw">st_polygon</span>(polygon_list)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt; POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5))</span></a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">## POLYGON with a hole</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">polygon_border =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">polygon_hole =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">polygon_with_hole_list =<span class="st"> </span><span class="kw">list</span>(polygon_border, polygon_hole)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw">st_polygon</span>(polygon_with_hole_list)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co">#&gt; POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5), (2 4, 3 4, 3 3, 2 3, 2 4))</span></a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">## MULTILINESTRING</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">multilinestring_list =<span class="st"> </span><span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)), </a>
<a class="sourceLine" id="cb22-3" data-line-number="3">                            <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)))</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="kw">st_multilinestring</span>((multilinestring_list))</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4))</span></a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">## MULTIPOLYGON</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">multipolygon_list =<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>))),</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">                         <span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>))))</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw">st_multipolygon</span>(multipolygon_list)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">#&gt; MULTIPOLYGON (((1 5, 2 2, 4 1, 4 4, 1 5)), ((0 2, 1 2, 1 3, 0 3, 0 2)))</span></a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">## GEOMETRYCOLLECTION</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">gemetrycollection_list =<span class="st"> </span><span class="kw">list</span>(<span class="kw">st_multipoint</span>(multipoint_matrix),</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">                              <span class="kw">st_linestring</span>(linestring_matrix))</a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="kw">st_geometrycollection</span>(gemetrycollection_list)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; GEOMETRYCOLLECTION (MULTIPOINT (5 2, 1 3, 3 4, 3 2),</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt;   LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2))</span></a></code></pre></div>
<!-- table -->
<!-- figure - image/fig1.jpg -->
<!-- they are interconnected - points could create mulitpoints or lines; -->
<!-- lines could create mutlilines or polygons, etc. -->
<!-- https://r-spatial.github.io/sf/articles/sf1.html -->
</div>
<div id="sfc" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Simple feature columns (sfc)</h3>
<p>One <code>sfg</code> object contains only a single simple feature geometry.
A simple feature geometry column (<code>sfc</code>) is a list of <code>sfg</code> objects, which is additionally able to contain information about the coordinate reference system in use.
For instance, to combine two simple features into one object with two features, we can use the <code>st_sfc()</code> function.
This is important since <code>sfc</code> represents the geometry column in <strong>sf</strong> data frames:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># sfc POINT</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">point1 =<span class="st"> </span><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">point2 =<span class="st"> </span><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">points_sfc =<span class="st"> </span><span class="kw">st_sfc</span>(point1, point2)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">points_sfc</a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt; Geometry set for 2 features </span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt; geometry type:  POINT</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co">#&gt; dimension:      XY</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">#&gt; bbox:           xmin: 1 ymin: 2 xmax: 5 ymax: 3</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">#&gt; epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="co">#&gt; proj4string:    NA</span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">#&gt; POINT (5 2)</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co">#&gt; POINT (1 3)</span></a></code></pre></div>
<p>In most cases, an <code>sfc</code> object contains objects of the same geometry type.
Therefore, when we convert <code>sfg</code> objects of type polygon into a simple feature geometry column, we would also end up with an <code>sfc</code> object of type polygon, which can be verified with <code>st_geometry_type()</code>.
Equally, a geometry column of multilinestrings would result in an <code>sfc</code> object of type multilinestring:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># sfc POLYGON</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">polygon_list1 =<span class="st"> </span><span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">polygon1 =<span class="st"> </span><span class="kw">st_polygon</span>(polygon_list1)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">polygon_list2 =<span class="st"> </span><span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">polygon2 =<span class="st"> </span><span class="kw">st_polygon</span>(polygon_list2)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">polygon_sfc =<span class="st"> </span><span class="kw">st_sfc</span>(polygon1, polygon2)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="kw">st_geometry_type</span>(polygon_sfc)</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">#&gt; [1] POLYGON POLYGON</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</span></a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># sfc MULTILINESTRING</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">multilinestring_list1 =<span class="st"> </span><span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)), </a>
<a class="sourceLine" id="cb27-3" data-line-number="3">                            <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)))</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">multilinestring1 =<span class="st"> </span><span class="kw">st_multilinestring</span>((multilinestring_list1))</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">multilinestring_list2 =<span class="st"> </span><span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">9</span>), <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>), <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">7</span>)), </a>
<a class="sourceLine" id="cb27-6" data-line-number="6">                            <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)))</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">multilinestring2 =<span class="st"> </span><span class="kw">st_multilinestring</span>((multilinestring_list2))</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">multilinestring_sfc =<span class="st"> </span><span class="kw">st_sfc</span>(multilinestring1, multilinestring2)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="kw">st_geometry_type</span>(multilinestring_sfc)</a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt; [1] MULTILINESTRING MULTILINESTRING</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</span></a></code></pre></div>
<p>It is also possible to create an <code>sfc</code> object from <code>sfg</code> objects with different geometry types:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># sfc GEOMETRY</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">point_multilinestring_sfc =<span class="st"> </span><span class="kw">st_sfc</span>(point1, multilinestring1)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="kw">st_geometry_type</span>(point_multilinestring_sfc)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="co">#&gt; [1] POINT           MULTILINESTRING</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</span></a></code></pre></div>
<!-- if you want to use it - st_cast() to a proper geometry type -->
<!-- or st_is to select only one geometry type -->
<!-- http://r-spatial.org/r/2017/01/12/newssf.html -->
<!-- methods(class = "sfc") -->
<p>As mentioned before, <code>sfc</code> objects can additionally store information on the coordinate reference systems (CRS).
<!-- What's CRS -->
To specify a certain CRS, we can use the <code>epsg (SRID)</code> or <code>proj4string</code> attributes of an <code>sfc</code> object.
The default value of <code>epsg (SRID)</code> and <code>proj4string</code> is <code>NA</code> (<em>Not Available</em>), as can be verified with <code>st_crs()</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">st_crs</span>(points_sfc)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co">#&gt; Coordinate Reference System: NA</span></a></code></pre></div>
<p>All geometries in an <code>sfc</code> object must have the same CRS.
We can add coordinate reference system as a <code>crs</code> argument of <code>st_sfc()</code>.
This argument accepts an integer with the <code>epsg</code> code such as <code>4326</code>, which automatically adds the ‘proj4string’ (see section <a href="spatial-class.html#crs-intro">2.3</a>):</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># EPSG definition</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">points_sfc_wgs =<span class="st"> </span><span class="kw">st_sfc</span>(point1, point2, <span class="dt">crs =</span> <span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="kw">st_crs</span>(points_sfc_wgs)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co">#&gt; Coordinate Reference System:</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="co">#&gt;   EPSG: 4326 </span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co">#&gt;   proj4string: &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span></a></code></pre></div>
<p>It also accepts a raw proj4string (result not shown):</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># PROJ4STRING definition</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw">st_sfc</span>(point1, point2, <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span>)</a></code></pre></div>
<!-- For example, we can set the UTM Zone 11N projection with `epsg` code `2955`: -->
<!-- ```{r, eval=FALSE} -->
<!-- st_sfc(point1, point2, crs = 2955) -->
<!-- #> ... -->
<!-- #> epsg (SRID):    2955 -->
<!-- #> proj4string:    +proj=utm +zone=11 +ellps=GRS80 ... +units=m +no_defs -->
<!-- #> POINT (5 2) -->
<!-- #> POINT (1 3) -->
<!-- ``` -->
<!-- As you can see above, the `proj4string` definition was automatically added. -->
<!-- The CRS can also be set with the full `proj4string` (result not shown): -->
<!-- ```{r, eval=FALSE} -->
<!-- p4s = "+proj=utm +zone=11 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs" -->
<!-- st_sfc(point1, point2, crs = crs_utm) -->
<!-- ``` -->

<div class="rmdnote">
Sometimes <code>st_crs()</code> will return a <code>proj4string</code> but not an <code>epsg</code> code.
This is because there is no general method to convert from <code>proj4string</code> to <code>epsg</code> (see Chapter <a href="reproj-geo-data.html#reproj-geo-data">6</a>).
</div>

<!-- precision -->
<!-- plots can be made -->
</div>
<div id="sf" class="section level3">
<h3><span class="header-section-number">2.1.8</span> The sf class</h3>
<p>Sections <a href="spatial-class.html#geometry">2.1.5</a> to <a href="spatial-class.html#sfc">2.1.7</a> deal with purely geometric objects, ‘sf geometry’ and ‘sf column’ objects respectively.
These are geographic building blocks of geographic vector data represented as simple features.
The final building block is non-geographic attributes, representing the name of the feature or other attributes such as measured values, groups, and other things.</p>
<p>To illustrate attributes, we will represent a temperature of 25°C in London on June 21<sup>st</sup> 2017.
This example contains a geometry (the coordinates), and three attributes with three different classes (place name, temperature and date).<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>
Objects of class <code>sf</code> represent such data by combining the attributes (<code>data.frame</code>) with the simple feature geometry column (<code>sfc</code>).
They are created with <code>st_sf()</code> as illustrated below, which creates the London example described above:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">lnd_point =<span class="st"> </span><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">51.5</span>))                 <span class="co"># sfg object</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">lnd_geom =<span class="st"> </span><span class="kw">st_sfc</span>(lnd_point, <span class="dt">crs =</span> <span class="dv">4326</span>)           <span class="co"># sfc object</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3">lnd_attrib =<span class="st"> </span><span class="kw">data.frame</span>(                           <span class="co"># data.frame object</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">  <span class="dt">name =</span> <span class="st">&quot;London&quot;</span>,</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">  <span class="dt">temperature =</span> <span class="dv">25</span>,</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">  <span class="dt">date =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2017-06-21&quot;</span>)</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">lnd_sf =<span class="st"> </span><span class="kw">st_sf</span>(lnd_attrib, <span class="dt">geometry =</span> lnd_geom)    <span class="co"># sf object</span></a></code></pre></div>
<p>What just happened? First, the coordinates were used to create the simple feature geometry (<code>sfg</code>).
Second, the geometry was converted into a simple feature geometry column (<code>sfc</code>), with a CRS.
Third, attributes were stored in a <code>data.frame</code>, which was combined with the <code>sfc</code> object with <code>st_sf()</code>.
This results in an <code>sf</code> object, as demonstrated below (some output ommited):</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">lnd_sf</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co">#&gt; Simple feature collection with 1 features and 3 fields</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="co">#&gt; ...</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="co">#&gt;     name temperature       date         geometry</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co">#&gt; 1 London          25 2017-06-21 POINT (0.1 51.5)</span></a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">class</span>(lnd_sf)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="co">#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</span></a></code></pre></div>
<p>The result shows that <code>sf</code> objects actually have two classes, <code>sf</code> and <code>data.frame</code>.
Simple features are simply data frames (square tables), but with spatial attributes (usually stored in a special <code>geom</code> list-column in the data frame).
This duality is central to the concept of simple features:
most of the time a <code>sf</code> can be treated as and behaves like a <code>data.frame</code>.
Simple features are, in essence, data frames with a spatial extension.</p>
<!-- https://r-spatial.github.io/sf/articles/sf1.html#how-attributes-relate-to-geometries -->
</div>
</div>
<div id="raster-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Raster data</h2>
<p>The geographic raster data model usually consists of a raster header
and a matrix (with rows and columns) representing equally spaced cells (often also called pixels; Figure <a href="spatial-class.html#fig:raster-intro-plot">2.9</a>:A).<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>
The raster header defines the coordinate reference system, the extent and the origin.
The origin (or starting point) is frequently the coordinate of the lower-left corner of the matrix (the <strong>raster</strong> package, however, uses the upper left corner, by default (Figure <a href="spatial-class.html#fig:raster-intro-plot">2.9</a>:B)).
The header defines the extent via the number of columns, the number of rows and the cell size resolution.
Hence, starting from the origin, we can easily access and modify each single cell by either using the ID of a cell (Figure <a href="spatial-class.html#fig:raster-intro-plot">2.9</a>:B) or by explicitly specifying the rows and columns.
This matrix representation avoids storing explicitly the coordinates for the four corner points (in fact it only stores one coordinate, namely the origin) of each cell corner as would be the case for rectangular vector polygons.
This and map algebra makes raster processing much more efficient and faster than vector data processing.
However, in contrast to vector data, the cell of one raster layer can only hold a single value.
The value might be numeric or categorical (Figure <a href="spatial-class.html#fig:raster-intro-plot">2.9</a>:C).</p>
<div class="figure" style="text-align: center"><span id="fig:raster-intro-plot"></span>
<img src="figures/raster-intro-plot-1.png" alt="Raster data: A - cell IDs; B - cell values; C - a colored raster map." width="576" />
<p class="caption">
Figure 2.9: Raster data: A - cell IDs; B - cell values; C - a colored raster map.
</p>
</div>
<p>Raster maps usually represent continuous phenomena such as elevation, temperature, population density or spectral data (Figure <a href="spatial-class.html#fig:raster-intro-plot2">2.10</a>).
Of course, we can represent discrete features such as soil or land-cover classes also with the help of a raster data model (Figure <a href="spatial-class.html#fig:raster-intro-plot2">2.10</a>).
Consequently, the discrete borders of these features become blurred, and depending on the spatial task a vector representation might be more suitable.</p>
<div class="figure" style="text-align: center"><span id="fig:raster-intro-plot2"></span>
<img src="figures/raster-intro-plot2-1.png" alt="Examples of continuous (left) and categorical (right) raster." width="576" />
<p class="caption">
Figure 2.10: Examples of continuous (left) and categorical (right) raster.
</p>
</div>
<div id="an-introduction-to-raster" class="section level3">
<h3><span class="header-section-number">2.2.1</span> An introduction to raster</h3>
<p>The <strong>raster</strong> package supports raster objects in R.
It provides an extensive set of functions to create, read, export, manipulate and process raster datasets.
Aside from general raster data manipulation, <strong>raster</strong> provides many low level functions that can form the basis to develop more advanced raster functionality.
<strong>raster</strong> also lets you work on large raster datasets that are too large to fit into the main memory.
In this case, <strong>raster</strong> provides the possibility to divide the raster into smaller chunks (rows or blocks), and processes these iteratively instead of loading the whole raster file into RAM (for more information, please refer to <code>vignette(&quot;functions&quot;, package = &quot;raster&quot;)</code>.</p>
<p>For the illustration of <strong>raster</strong> concepts, we will use datasets from the <strong>spDataLarge</strong> (note these packages were loaded at the beginning of the chapter).
It consists of a few raster and one vector datasets covering an area of the Zion National Park (Utah, USA).
For example, <code>srtm.tif</code> is a digital elevation model of this area (for more details - see its documentation <code>?srtm</code>)
First of all, we would like to create a <code>RasterLayer</code> object named <code>new_raster</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">raster_filepath =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/srtm.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">new_raster =<span class="st"> </span><span class="kw">raster</span>(raster_filepath)</a></code></pre></div>
<p>Typing the name of the raster into the console, will print out the raster header (extent, dimensions, resolution, CRS) and some additional information (class, data source name, summary of the raster values):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">new_raster</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="co">#&gt; class       : RasterLayer </span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="co">#&gt; dimensions  : 457, 465, 212505  (nrow, ncol, ncell)</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="co">#&gt; resolution  : 0.000833, 0.000833  (x, y)</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="co">#&gt; extent      : -113, -113, 37.1, 37.5  (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="co">#&gt; coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 </span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="co">#&gt; data source : /home/robin/R/x86_64-pc-linux../3.5/spDataLarge/raster/srtm.tif </span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8"><span class="co">#&gt; names       : srtm </span></a>
<a class="sourceLine" id="cb36-9" data-line-number="9"><span class="co">#&gt; values      : 1024, 2892  (min, max)</span></a></code></pre></div>
<p>Dedicated functions report each component: <code>dim(new_raster)</code> returns the number of rows, columns and layers; the <code>ncell()</code> function the number cells (pixels); <code>res()</code> the raster’s spatial resolution; <code>extent()</code> its spatial extent; and <code>crs()</code> its coordinate reference system (raster reprojection is covered in section <a href="reproj-geo-data.html#reprojecting-raster-geometries">6.6</a>).
<code>inMemory()</code> reports whether the the raster data is stored in memory (the default) or on disk.</p>
<!--CRSargs(CRS("+init=epsg:4326"))-->
<!-- Note that in contrast to the **sf** package, **raster** only accepts the `proj4string` representation of the coordinate reference system. -->
<!--
You can also summarize and plot raster cell values in a non-spatial fashion using base R functions such as `summary()` and `hist()`.


```r
# numerical summary of the data
summary(new_raster)
#> Warning in .local(object, ...): summary is an estimate based on a sample of 1e+05 cells (47.06% of all cells)
#>         srtm
#> Min.    1034
#> 1st Qu. 1535
#> Median  1839
#> 3rd Qu. 2115
#> Max.    2892
#> NA's       0
```


```r
# histogram of the values
hist(new_raster)
#> Warning in .hist1(x, maxpixels = maxpixels, main = main, plot = plot, ...):
#> 47% of the raster cells were used. 100000 values used.
```

<img src="figures/new_raster-hist-1.png" width="576" style="display: block; margin: auto;" />

`getValues()` extracts the values of a raster as a numerical vector.
To only select specific rows, use the `row` parameter.


```r
new_raster_values = getValues(new_raster)
head(new_raster_values)
#> [1] 1728 1718 1715 1710 1703 1701
```

The new vector, `new_raster_values`, can serve as input for subsequent statistical operations.
-->
<p><code>help(&quot;raster-package&quot;)</code> returns a full list of all available <strong>raster</strong> functions.</p>

<div class="rmdnote">
The current version of <strong>raster</strong> (2.6.7) is not fully compatible with <code>sf</code> objects.
We therefore suggest converting <code>sf</code> objects to an intermediate <code>Spatial</code> class (from the <strong>sp</strong> package) for compatibility between raster and vector data, for example <code>crop(raster_obj, as(sf_object, &quot;Spatial&quot;)</code> (see section <a href="geometric-operations.html#raster-vector">5.4</a>).
</div>

</div>
<div id="basic-map-raster" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Basic map making</h3>
<p>Similar to the <strong>sf</strong> package, <strong>raster</strong> also provides <code>plot()</code> methods for its own classes.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">plot</span>(new_raster)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:basic-new-raster-plot"></span>
<img src="figures/basic-new-raster-plot-1.png" alt="Basic raster plot." width="576" />
<p class="caption">
Figure 2.11: Basic raster plot.
</p>
</div>
<!-- Moreover, it is possible to plot a raster and overlay it with vector data. -->
<!-- For this purpose, we need to read-in a vector dataset: -->
<!-- ```{r, message=FALSE, results='hide'} -->
<!-- vector_filepath = system.file("vector/zion.gpkg", package="spDataLarge") -->
<!-- new_vector = st_read(vector_filepath) -->
<!-- ``` -->
<!-- Our new object, `new_vector`, is a polygon representing the borders of Zion National Park (`?zion`). -->
<!-- We can add the borders to the elevation map using the `add` argument of the `plot()`: -->
<!-- ```{r basic-new-raster-vector-plot} -->
<!-- plot(new_raster) -->
<!-- plot(new_vector$geom, add = TRUE) -->
<!-- ``` -->
<p>There are several other approaches for plotting raster data in R that are outside the scope of this section, including:</p>
<ul>
<li>Functions such as <code>spplot()</code> and <code>levelplot()</code> (from the <strong>sp</strong> and <strong>rasterVis</strong> packages, respectively) to create facets, a common technique for visualizing change over time.</li>
<li>Packages such as <strong>tmap</strong>, <strong>mapview</strong> and <strong>leaflet</strong> to create interactive maps of raster and vector objects (see Chapter <a href="adv-map.html#adv-map">8</a>).</li>
</ul>
</div>
<div id="raster-classes" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Raster classes</h3>
<p>The <code>RasterLayer</code> class represents the simplest form of a raster object, and consists of only one layer.
The easiest way to create a raster object in R is to read-in a raster file from disk or from a server.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">raster_filepath =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/srtm.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">new_raster =<span class="st"> </span><span class="kw">raster</span>(raster_filepath)</a></code></pre></div>
<p>The <strong>raster</strong> package supports numerous drivers with the help of <strong>rgdal</strong>.
To find out which drivers are available on your system, run <code>raster::writeFormats()</code> and <code>rgdal::gdalDrivers()</code>.</p>
<p>Rasters can also be created from scratch using the <code>raster()</code> function.
This is illustrated in the subsequent code chunk, which results in a new <code>RasterLayer</code> object.
The resulting raster consists of 36 cells (6 columns and 6 rows specified by <code>nrows</code> and <code>ncols</code>) centered around the Prime Meridian and the Equator (see <code>xmn</code>, <code>xmx</code>, <code>ymn</code> and <code>ymx</code> parameters).
The CRS is the default of raster objects: WGS84.
This means the unit of the resolution is in degrees which we set to 0.5 (<code>res</code>).
Values (<code>vals</code>) are assigned to each cell: 1 to cell 1, 2 to cell 2, and so on.
Remember: <code>raster()</code> fills cells row-wise (unlike <code>matrix()</code>) starting at the upper left corner, meaning the top row contains the values 1 to 6, the second 7 to 12 etc.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">new_raster2 =<span class="st"> </span><span class="kw">raster</span>(<span class="dt">nrows =</span> <span class="dv">6</span>, <span class="dt">ncols =</span> <span class="dv">6</span>, <span class="dt">res =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb39-2" data-line-number="2">                     <span class="dt">xmn =</span> <span class="fl">-1.5</span>, <span class="dt">xmx =</span> <span class="fl">1.5</span>, <span class="dt">ymn =</span> <span class="fl">-1.5</span>, <span class="dt">ymx =</span> <span class="fl">1.5</span>,</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">                     <span class="dt">vals =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">36</span>)</a></code></pre></div>
<p>For still further ways of creating a raster object have a look at the help file - <code>?raster</code>.
<!--
There are several ways to add new values to the `Raster*` objects.
Values for the whole object could be add with `setValues()`:


```r
# adding random values to the raster object
new_random_values = sample(seq_len(ncell(new_raster4)))
setValues(new_raster4, new_random_values)
```


It is also possible to replace cell values by specifying cell numbers, or row and column numbers:


```r
# change the value of 15th cell to 826
new_raster4[15] = 826
# change the value of the cell in the second row and forth column to 826
new_raster4[2, 4] = 826 
```
--></p>
<p>Aside from <code>RasterLayer</code>, there are two additional classes: <code>RasterBrick</code> and <code>RasterStack</code>.
Both can handle multiple layers, but differ regarding the number of supported file formats, type of internal representation and processing speed.</p>
<p>A <code>RasterBrick</code> consists of multiple layers, which typically correspond to a single multispectral satellite file or a single multilayer object in memory.
The <code>brick()</code> function creates a <code>RasterBrick</code> object.
Usually, you provide it with a filename to a multilayer raster file but might also use another raster object and other spatial objects (see <code>?brick</code> for all supported formats).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">multi_raster_file =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/landsat.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">r_brick =<span class="st"> </span><span class="kw">brick</span>(multi_raster_file)</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">r_brick</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="co">#&gt; class       : RasterBrick </span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="co">#&gt; resolution  : 30, 30  (x, y)</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co">#&gt; ...</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="co">#&gt; names       : landsat.1, landsat.2, landsat.3, landsat.4 </span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="co">#&gt; min values  :      7550,      6404,      5678,      5252 </span></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="co">#&gt; max values  :     19071,     22051,     25780,     31961</span></a></code></pre></div>
<p><code>nlayers()</code> retrieves the number of layers stored in a <code>Raster*</code> object:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">nlayers</span>(r_brick)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<p>A <code>RasterStack</code> is similar to a <code>RasterBrick</code> in the sense that it consists also of multiple layers.
However, in contrast to <code>RasterBrick</code>, <code>RasterStack</code> allows you to connect several raster objects stored in different files or multiply objects in memory.
More specifically, a <code>RasterStack</code> is a list of <code>RasterLayer</code> objects with the same extent and resolution.
Hence, one way to create it is with the help of spatial objects already existing in R’s global environment.
And again, one can simply specify a path to a file stored on disk.
<!-- The possibility to create a `RasterStack` from a file stored on disk and an object residing in R's global environment is one of the main differences compared to a `RasterBrick`. --></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">raster_on_disk =<span class="st"> </span><span class="kw">raster</span>(r_brick, <span class="dt">layer =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">raster_in_memory =<span class="st"> </span><span class="kw">raster</span>(<span class="dt">xmn =</span> <span class="dv">301905</span>, <span class="dt">xmx =</span> <span class="dv">335745</span>,</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">                          <span class="dt">ymn =</span> <span class="dv">4111245</span>, <span class="dt">ymx =</span> <span class="dv">4154085</span>, </a>
<a class="sourceLine" id="cb43-4" data-line-number="4">                          <span class="dt">res =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb43-5" data-line-number="5"><span class="kw">values</span>(raster_in_memory) =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(<span class="kw">ncell</span>(raster_in_memory)))</a>
<a class="sourceLine" id="cb43-6" data-line-number="6"><span class="kw">crs</span>(raster_in_memory) =<span class="st"> </span><span class="kw">crs</span>(raster_on_disk)</a></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">r_stack =<span class="st"> </span><span class="kw">stack</span>(raster_in_memory, raster_on_disk)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">r_stack</a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="co">#&gt; class : RasterStack</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="co">#&gt; dimensions : 1428, 1128, 1610784, 2</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="co">#&gt; resolution : 30, 30</span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="co">#&gt; ...</span></a>
<a class="sourceLine" id="cb44-7" data-line-number="7"><span class="co">#&gt; names       :   layer, landsat.1 </span></a>
<a class="sourceLine" id="cb44-8" data-line-number="8"><span class="co">#&gt; min values  :       1,      7550 </span></a>
<a class="sourceLine" id="cb44-9" data-line-number="9"><span class="co">#&gt; max values  : 1610784,     19071</span></a></code></pre></div>
<p>Another difference is that the processing time for <code>RasterBrick</code> objects is usually shorter than for <code>RasterStack</code> objects.</p>
<p>Decision on which <code>Raster*</code> class should be used depends mostly on a character of input data.
Processing of a single mulitilayer file or object is the most effective with <code>RasterBrick</code>, while <code>RasterStack</code> allows calculations based on many files, many <code>Raster*</code> objects, or both.</p>

<div class="rmdnote">
Operations on <code>RasterBrick</code> and <code>RasterStack</code> objects will typically return a <code>RasterBrick</code>.
</div>

</div>
</div>
<div id="crs-intro" class="section level2">
<h2><span class="header-section-number">2.3</span> Coordinate Reference Systems</h2>
<p>Vector and raster spatial data types share concepts intrinsic to spatial data.
Perhaps the most fundamental of these is the Coordinate Reference System (CRS), which defines how the spatial elements of the data relate to the surface of the Earth (or other bodies).
<!-- Coordinates are meaningless without a CRS, as we don't know theirs units (meters, feets, degrees) or what's the origin -->
<!-- (-12579102, 4439107) = (-113, 37) -->
CRSs are either geographic or projected, as introduced at the beginning of this chapter (see Figure <a href="spatial-class.html#fig:vectorplots">2.1</a>).
This section will will explain each type, laying the foundations for section <a href="reproj-geo-data.html#reproj-geo-data">6</a> on CRS transformations.</p>
<div id="geographic-coordinate-systems" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Geographic coordinate systems</h3>
<p>Geographic coordinate systems identify any location on the Earth’s surface using two values — longitude and latitude.
<em>Longitude</em> is location in the East-West direction in angular distance from the Prime Meridian plane.
<em>Latitude</em> is angular distance North or South of the equatorial plane.
Distance in geographic CRSs are therefore not measured in meters.
This has important consequences, as demonstrated in section <a href="reproj-geo-data.html#reproj-geo-data">6</a>.</p>
<p>The surface of the Earth in geographic coordinate systems is represented by a spherical or ellipsoidal surface.
Spherical models assume that the Earth is a perfect sphere of a given radius.
Spherical models have the advantage of simplicity but are rarely used because they are inaccurate: the Earth is not a sphere!
Ellipsoidal models are defined by two parameters: the equatorial radius and the polar radius.
These are suitable because the Earth is compressed: the equatorial radius is around 11.5 km longer than the polar radius <span class="citation">(Maling <a href="#ref-maling_coordinate_1992">1992</a>)</span>.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></p>
<p>Ellipsoids are part of a wider component of CRSs: the <em>datum</em>.
This contains information on what ellipsoid to use (with the <code>ellps</code> parameter in the proj4 CRS library) and the precise relationship between the Cartesian coordinates and location on the Earth’s surface.
These additional details are stored in the <code>towgs84</code> argument of <a href="https://proj4.org/operations/conversions/latlon.html?highlight=towgs#cmdoption-arg-towgs84">proj4</a> notation (see <a href="https://proj4.org/usage/projections.html">proj4.org/parameters.html</a> for details).
These allow local variations in Earth’s surface, e.g. due to large mountain ranges, to be accounted for in a local CRS.
There are two types of datum — local and geocentric.
In a <em>local datum</em> such as <code>NAD83</code> the ellipsoidal surface is shifted to align with the surface at a particular location.
In a <em>geocentric datum</em> such as <code>WGS84</code> the center is the Earth’s center of gravity and the accuracy of projections is not optimized for a specific location.
Available datum definitions can be seen by executing <code>st_proj_info(type = &quot;datum&quot;)</code>.
<!-- plots? -->
<!-- plus maybe table (few examples) --></p>
</div>
<div id="projected-coordinate-systems" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Projected coordinate systems</h3>
<p>Projected CRSs are based on Cartesian coordinates on an implicitly flat surface.
They have an origin, x and y axes, and a linear unit of measurement such as meters.
All projected CRSs are based on a geographic CRS, described in the previous section, and rely on map projections to convert the three-dimensional surface of the Earth into Easting and Northing (x and y) values in a projected CRS.</p>
<p>This transition cannot be done without adding some distortion.
Therefore, some properties of the Earth’s surface are distorted in this process, such as area, direction, distance, and shape.
A projected coordinate system can preserve only one or two of those properties.
Projections are often named based on a property they preserve: equal-area preserves area, azimuthal preserve direction, equidistant preserve distance, and conformal preserve local shape.</p>
<p>There are three main groups of projection types - conic, cylindrical, and planar.
In a conic projection, the Earth’s surface is projected onto a cone along a single line of tangency or two lines of tangency.
Distortions are minimized along the tangency lines and rise with the distance from those lines in this projection.
Therefore, it is the best suited for maps of mid-latitude areas.
A cylindrical projection maps the surface onto a cylinder.
This projection could also be created by touching the Earth’s surface along a single line of tangency or two lines of tangency.
Cylindrical projections are used most often when mapping the entire world.
A planar projection projects data onto a flat surface touching the globe at a point or along a line of tangency.
It is typically used in mapping polar regions.
<!-- other projections? -->
<!-- https://en.wikipedia.org/wiki/List_of_map_projections -->
<!-- plus maybe table (few examples) -->
<!-- add good reference to projections -->
<code>st_proj_info(type = &quot;proj&quot;)</code> gives a list of the available projections supported by the PROJ library.</p>
<!-- maybe a new section - how to pick the best projection? -->
<!-- https://source.opennews.org/articles/choosing-right-map-projection/ -->
</div>
<div id="crs-in-r" class="section level3">
<h3><span class="header-section-number">2.3.3</span> CRSs in R</h3>
<p>Two main ways to describe CRS in R are an <code>epsg</code> code or a <code>proj4string</code> definition.
Both of these approaches have advantages and disadvantages.
An <code>epsg</code> code is usually shorter, and therefore easier to remember.
The code also refers to only one, well-defined coordinate reference system.
On the other hand, a <code>proj4string</code> definition allows you more flexibility when it comes to specifying different parameters such as the projection type, the datum and the ellipsoid.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>
This way you can specify many different projections, and modify existing ones.
This also makes the <code>proj4string</code> approach more complicated.
<!-- ^[In the background, `sf` and `raster` use the [PROJ](http://proj4.org/) software, which enables transformations between different projections]. -->
<code>epsg</code> points to exactly one particular CRS.</p>
<p>Spatial R packages support a wide range of CRSs and they use the long-established <a href="http://proj4.org/">proj4</a> library.
Other than searching for EPSG codes online, another quick way to find out about available CRSs is via the <code>rgdal::make_EPSG()</code> function, which outputs a data frame of available projections.
Before going into more detail, it’s worth learning how to view and filter them inside R, as this could save time trawling the internet.
The following code will show available CRSs interactively, allowing you to filter ones of interest (try filtering for the OSGB CRSs for example):</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">crs_data =<span class="st"> </span>rgdal<span class="op">::</span><span class="kw">make_EPSG</span>()</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="kw">View</span>(crs_data)</a></code></pre></div>
<p>In <strong>sf</strong> the CRS of an object can be retrieved using <code>st_crs()</code>.
For this, we need to read-in a vector dataset:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">vector_filepath =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;vector/zion.gpkg&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">new_vector =<span class="st"> </span><span class="kw">st_read</span>(vector_filepath)</a></code></pre></div>
<p>Our new object, <code>new_vector</code>, is a polygon representing the borders of Zion National Park (<code>?zion</code>).</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">st_crs</span>(new_vector) <span class="co"># get CRS</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="co">#&gt; Coordinate Reference System:</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="co">#&gt; No EPSG code</span></a>
<a class="sourceLine" id="cb47-4" data-line-number="4"><span class="co">#&gt; proj4string: &quot;+proj=utm +zone=12 +ellps=GRS80 ... +units=m +no_defs&quot;</span></a></code></pre></div>
<p>In cases when a coordinate reference system (CRS) is missing or the wrong CRS is set, the <code>st_set_crs()</code> function can be used:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">new_vector =<span class="st"> </span><span class="kw">st_set_crs</span>(new_vector, <span class="dv">26912</span>) <span class="co"># set CRS</span></a></code></pre></div>
<p>The warning message informs us that the <code>st_set_crs()</code> function does not transform data from one CRS to another.</p>
<pre><code>#&gt; Reading layer `zion&#39; from data source `/home/travis/R/Library/spDataLarge/vector/zion.gpkg&#39; using driver `GPKG&#39;
#&gt; Simple feature collection with 1 feature and 11 fields
#&gt; geometry type:  POLYGON
#&gt; dimension:      XY
#&gt; bbox:           xmin: 303000 ymin: 4110000 xmax: 335000 ymax: 4150000
#&gt; epsg (SRID):    NA
#&gt; proj4string:    +proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<div class="figure" style="text-align: center"><span id="fig:vector-crs"></span>
<img src="figures/vector-crs-1.png" alt="Examples of geographic (WGS 84; left) and projected (NAD83 / UTM zone 12N; right) and coordinate systems for a vector data type." width="576" />
<p class="caption">
Figure 2.12: Examples of geographic (WGS 84; left) and projected (NAD83 / UTM zone 12N; right) and coordinate systems for a vector data type.
</p>
</div>
<p>The <code>projection()</code> function can be used to access CRS information from a <code>Raster*</code> object:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">projection</span>(new_raster) <span class="co"># get CRS</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="co">#&gt; [1] &quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</span></a></code></pre></div>
<p>The same function, <code>projection()</code>, is used to set a CRS for raster objects.
The main difference, compared to vector data, is that raster objects only accept <code>proj4</code> definitions:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">projection</span>(new_raster) =<span class="st"> &quot;+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 </span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">                            +units=m +no_defs&quot;</span> <span class="co"># set CRS</span></a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:raster-crs"></span>
<img src="figures/raster-crs-1.png" alt="Examples of geographic (WGS 84; left) and projected (NAD83 / UTM zone 12N; right) and coordinate systems for a raster data type." width="576" />
<p class="caption">
Figure 2.13: Examples of geographic (WGS 84; left) and projected (NAD83 / UTM zone 12N; right) and coordinate systems for a raster data type.
</p>
</div>
<p>We will expand on CRSs and how to project from one CRS to another in much more detail in chapter <a href="reproj-geo-data.html#reproj-geo-data">6</a>.
<!-- comparing projections? == -->
<!-- - st_as_sf(x, coords = c("x","y")) -->
<!-- - st_bbox --></p>
</div>
</div>
<div id="units" class="section level2">
<h2><span class="header-section-number">2.4</span> Units</h2>
<!-- https://cran.r-project.org/web/packages/units/vignettes/measurement_units_in_R.html -->
<p>An important feature of CRSs is that they contain information about spatial units.
Clearly it is vital to know whether a house’s measurements are in feet or meters, and the same applies to maps.
It is good cartographic practice to add a <em>scale bar</em> onto maps to demonstrate the relationship between distances on the page or screen and distances on the ground.
Likewise, it is important to formally specify the units in which the geometry data or pixels are measured to provide context, and ensure that subsequent calculations are done in context.</p>
<p>A novel feature of geometry data in <code>sf</code> objects is that they have <em>native support</em> for units.
This means that distance, area and other geometric calculations in <strong>sf</strong> return values that come with a <code>units</code> attribute, defined by the <strong>units</strong> package <span class="citation">(Pebesma, Mailund, and Hiebert <a href="#ref-pebesma_measurement_2016">2016</a>)</span>.
This is advantageous because it prevents confusion caused by the fact that different CRSs use different units (most use meters, some use feet).
Furthermore, it also provides information on dimensionality, as illustrated by the following calculation which reports the area of Luxembourg:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">luxembourg =<span class="st"> </span>world[world<span class="op">$</span>name_long <span class="op">==</span><span class="st"> &quot;Luxembourg&quot;</span>, ]</a></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">st_area</span>(luxembourg)</a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="co">#&gt; 2.41e+09 m^2</span></a></code></pre></div>
<p>The result is in units of square meters (m<sup>2</sup>), showing that the result represents two-dimensional space.
This information, stored as an attribute (which interested readers can discover with <code>attributes(st_area(luxembourg))</code>) is advantageous for many reasons, for example it could feed into subsequent calculations such as population density.
Reporting units prevents confusion.
To take the Luxembourg example, if the units remained unspecified, one could incorrectly assume that the units were in hectares.
To translate the huge number into a more digestible size, it is tempting to divide the results by a million (the number of square meters in a square kilometer):</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">st_area</span>(luxembourg) <span class="op">/</span><span class="st"> </span><span class="dv">1000000</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="co">#&gt; 2414 m^2</span></a></code></pre></div>
<p>However, the result is incorrectly given again as square meters.
The solution is to set the correct units with the <strong>units</strong> package:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">units<span class="op">::</span><span class="kw">set_units</span>(<span class="kw">st_area</span>(luxembourg), km<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="co">#&gt; 2414 km^2</span></a></code></pre></div>
<!-- Is that right? I mean, the units DESCRIPTION says "Support for measurement units in R vectors, matrices and arrays". Since raster datasets are just matrices, units might be easily used with them?-->
<p>Units are of equal importance in the case of raster data.
However, so far <strong>sf</strong> is the only spatial package that supports units, meaning that people working on raster data should approach changes in the units of analysis (for example, converting pixel widths from imperial to decimal units) with care.
The <code>new_raster</code> object (see above) uses a UTM projection with meters as units.
Consequently, its resolution is also given in meters but you have to know it, since the <code>res()</code> function simply returns a numeric vector.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">res</span>(new_raster)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="co">#&gt; [1] 0.000833 0.000833</span></a></code></pre></div>
<p>If we used the WGS84 projection, the units would change.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">repr =<span class="st"> </span><span class="kw">projectRaster</span>(new_raster, <span class="dt">crs =</span> <span class="st">&quot;+init=epsg:4326&quot;</span>)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="kw">res</span>(repr)</a>
<a class="sourceLine" id="cb57-3" data-line-number="3"><span class="co">#&gt; [1] 0.000833 0.000833</span></a></code></pre></div>
<p>Again, the <code>res()</code> command gives back a numeric vector without any unit, forcing us to know that the unit of the WGS84 projection is decimal degrees.</p>
<!-- Something about when units are not set: -->
<!-- ```{r} -->
<!-- st_distance(sf_point1, sf_point2) -->
<!-- ``` -->
<!-- ## Precision -->
</div>
<div id="ex2" class="section level2">
<h2><span class="header-section-number">2.5</span> Exercises</h2>
<!-- vector exercises -->
<ol style="list-style-type: decimal">
<li>What does the summary of the <code>geometry</code> column tell us about the <code>world</code> dataset, in terms of:
<ul>
<li>The geometry type?</li>
<li>How many countries there are?</li>
<li>The coordinate reference system (CRS)?</li>
</ul></li>
<li>Using <strong>sf</strong>’s <code>plot()</code> command, create a map of Nigeria in context, building on the code that creates and plots Asia above (see section <a href="spatial-class.html#basic-map">2.1.3</a>).
<ul>
<li>Hint: this used the <code>lwd</code>, <code>main</code> and <code>col</code> arguments of <code>plot()</code>.</li>
<li>Bonus: make the country boundaries a dotted gray line.</li>
<li>Hint: <code>border</code> is an additional argument of <code>plot()</code> for <strong>sf</strong> objects.</li>
</ul></li>
<li>What does the <code>cex</code> argument do in the <code>plot()</code> function that generates Figure <a href="spatial-class.html#fig:contpop">2.5</a>?
<ul>
<li>Why was <code>cex</code> set to the <code>sqrt(world$pop) / 10000</code> instead of just the population directly?</li>
<li>Bonus: what equivalent arguments to <code>cex</code> exist in the dedicated visualization package <strong>tmap</strong>?</li>
</ul></li>
<li>Re-run the code that ‘generated’ Figure <a href="spatial-class.html#fig:contpop">2.5</a> at the end of <a href="spatial-class.html#base-args">2.1.4</a> and find 3 similarities and 3 differences between the plot produced on your computer and that in the book.
<ul>
<li>What is similar?</li>
<li>What has changed?</li>
<li>Bonus: play around with and research base plotting arguments to make your version of Figure <a href="spatial-class.html#fig:contpop">2.5</a> more attractive. Which arguments were most useful?</li>
<li>Advanced: try to reproduce the map presented in Figure <a href="spatial-class.html#base-args">2.1.4</a>. Copy-and-pasting is prohibited!
<!-- raster exercises --></li>
</ul></li>
<li>Read the <code>raster/nlcd2011.tif</code> file from the <strong>spDataLarge</strong> package.
What kind of information can you get about the properties of this file?
<!-- (crs, ncols, nrow, ncells, bbox, navalues) --></li>
<li>Create an empty <code>RasterLayer</code> object called <code>my_raster</code> with 10 columns and 10 rows and resolution of 10 units.
Assign random values between 0 and 10 to the new raster and plot it.
<!-- crs exercises -->
<!-- 1. pros and cons of the projection types -->
<!-- 1. pros and cons of epsg/proj4 -->
<!-- units exercises -->
<!-- 1. ?? --></li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-gillespie_efficient_2016">
<p>Gillespie, Colin, and Robin Lovelace. 2016. <em>Efficient R Programming: A Practical Guide to Smarter Programming</em>. O’Reilly Media.</p>
</div>
<div id="ref-grolemund_r_2016">
<p>Grolemund, Garrett, and Hadley Wickham. 2016. <em>R for Data Science</em>. 1 edition. O’Reilly Media.</p>
</div>
<div id="ref-pebesma_simple_2018">
<p>Pebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” <em>The R Journal</em>.</p>
</div>
<div id="ref-R-sp">
<p>Pebesma, Edzer, and Roger Bivand. 2018. <em>Sp: Classes and Methods for Spatial Data</em>. <a href="https://CRAN.R-project.org/package=sp" class="uri">https://CRAN.R-project.org/package=sp</a>.</p>
</div>
<div id="ref-R-rgdal">
<p>Bivand, Roger, Tim Keitt, and Barry Rowlingson. 2018. <em>Rgdal: Bindings for the ’Geospatial’ Data Abstraction Library</em>. <a href="https://CRAN.R-project.org/package=rgdal" class="uri">https://CRAN.R-project.org/package=rgdal</a>.</p>
</div>
<div id="ref-R-rgeos">
<p>Bivand, Roger, and Colin Rundel. 2018. <em>Rgeos: Interface to Geometry Engine - Open Source (’Geos’)</em>. <a href="https://CRAN.R-project.org/package=rgeos" class="uri">https://CRAN.R-project.org/package=rgeos</a>.</p>
</div>
<div id="ref-maling_coordinate_1992">
<p>Maling, D. H. 1992. <em>Coordinate Systems and Map Projections</em>. 2nd ed. Oxford ; New York: Pergamon Press.</p>
</div>
<div id="ref-pebesma_measurement_2016">
<p>Pebesma, Edzer, Thomas Mailund, and James Hiebert. 2016. “Measurement Units in R.” <em>The R Journal</em> 8 (2): 486–94.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>
Note that <strong>spDataLarge</strong> is not on CRAN, meaning that the <code>repos</code> and <code>type</code> arguments must be set for it to install.
<!-- In case the installation fails, for example if you do not have rights to install non CRAN packages on your organisation's computers, the data in **spDataLarge** can be loaded by running the script [`spData.R`](https://github.com/Robinlovelace/geocompr/blob/master/code/spData.R) from the `code` folder in the book's GitHub repo at [github.com/Robinlovelace/geocompr](https://github.com/Robinlovelace/geocompr). --><a href="spatial-class.html#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>
The origin we are referring to, depicted in blue in Figure <a href="spatial-class.html#fig:vectorplots">2.1</a>, is in fact the ‘false’ origin.
The ‘true’ origin, the location at which distortions are at a minimum, is located at 2° W and 49° N.
This was selected by the Ordnance Survey to be roughly in the center of the British landmass longitudinally.
<!-- This was selected by the [Ordnance Survey](https://www.ordnancesurvey.co.uk/support/the-national-grid.html) to be roughly in the center of the British landmass longitudinally. --><a href="spatial-class.html#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>
The full OGC standard includes rather exotic geometry types including ‘surface’ and ‘curve’ geometry types, which currently have limited application in real world applications.
All 68 types can be represented with the <strong>sf</strong> package, although (as of summer 2018) plotting only works for the ‘core 7’.<a href="spatial-class.html#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>The
development version, which may contain new features, can be installed with <code>devtools::install_github(&quot;r-spatial/sf&quot;).</code><a href="spatial-class.html#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>
<code>plot()</code>ing of <strong>sf</strong> objects uses <code>sf:::plot.sf()</code> behind the scenes.
<code>plot()</code> is a generic method that behaves differently depending on the class of object being plotted.<a href="spatial-class.html#fnref9" class="footnote-back">↩</a></p></li>
<li id="fn10"><p>
Note: many plot arguments are ignored in facet maps, when more than one <code>sf</code> column is plotted.<a href="spatial-class.html#fnref10" class="footnote-back">↩</a></p></li>
<li id="fn11"><p>
By definition, a polygon has one exterior boundary (outer ring) and can have zero or more interior boundaries (inner rings), also known as holes.
A polygon with a hole would be, for example, <code>POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5), (2 4, 3 4, 3 3, 2 3, 2 4))</code><a href="spatial-class.html#fnref11" class="footnote-back">↩</a></p></li>
<li id="fn12"><p>
Other attributes might include a urbanity category (city or village), or a remark if the measurement was made using an automatic station.<a href="spatial-class.html#fnref12" class="footnote-back">↩</a></p></li>
<li id="fn13"><p>
Depending on the file format the header is part of the actual image data file, e.g., GeoTIFF, or stored in an extra header or world file, e.g., ASCII grid formats. There is also the headerless (flat) binary raster format which should fascilitate the import into various software programs.
<!-- To convert these files into other raster formats requiring a header information, the user is often forced to provide the header information manually, see e.g. https://lta.cr.usgs.gov/glcc/technote. --><a href="spatial-class.html#fnref13" class="footnote-back">↩</a></p></li>
<li id="fn14"><p>
The degree of compression is often referred to as <em>flattening</em>, defined in terms of the equitorial radius (<span class="math inline">\(a\)</span>) and polar radius (<span class="math inline">\(b\)</span>) as follows: <span class="math inline">\(f = (a - b) / a\)</span>. The terms <em>ellipticity</em> and <em>compression</em> can also be used <span class="citation">(Maling <a href="#ref-maling_coordinate_1992">1992</a>)</span>.
<!-- The degree of compression is often referred to as [*flattening*](https://en.wikipedia.org/wiki/Flattening), defined in terms of the equitorial radius ($a$) and polar radius ($b$) as follows: $f = (a - b) / a$. The terms *ellipticity* and *compression* can also be used [@maling_coordinate_1992]. -->
Because <span class="math inline">\(f\)</span> is a rather small value, digital ellipsoid models use the ‘inverse flattening’ (<span class="math inline">\(rf = 1/f\)</span>) to define the Earth’s compression.
Values of <span class="math inline">\(a\)</span> and <span class="math inline">\(rf\)</span> used in a variety of ellipsoidal models can be seen be executing <code>st_proj_info(type = &quot;ellps&quot;)</code>.<a href="spatial-class.html#fnref14" class="footnote-back">↩</a></p></li>
<li id="fn15"><p>
A complete list of the <code>proj4string</code> parameters can be found at <a href="https://proj4.org/" class="uri">https://proj4.org/</a>.<a href="spatial-class.html#fnref15" class="footnote-back">↩</a></p></li>
</ol>
</div>
<script>
/*
Sorts the references alphabetically.
Modified from code by Yvonne Aburrow.
*/
$(function(){
    var elems = $('#refs').children('div').remove();
    elems.sort(function (a, b) {
        return $(b).children('p').html().toUpperCase() > $(a).children('p').html().toUpperCase() ? -1 : 1;
    });
    $('#refs').append(elems);
})
</script>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="attr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Robinlovelace/geocompr/edit/master/02-spatial-data.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
