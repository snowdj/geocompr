<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Geocomputation with R</title>
  <meta name="description" content="A book on geographic data with R.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Geocomputation with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://geocompr.robinlovelace.net/" />
  <meta property="og:image" content="https://geocompr.robinlovelace.net/images/cover.png" />
  <meta property="og:description" content="A book on geographic data with R." />
  <meta name="github-repo" content="Robinlovelace/geocompr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Geocomputation with R" />
  
  <meta name="twitter:description" content="A book on geographic data with R." />
  <meta name="twitter:image" content="https://geocompr.robinlovelace.net/images/cover.png" />

<meta name="author" content="Robin Lovelace, Jakub Nowosad, Jannes Muenchow">


<meta name="date" content="2018-09-26">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="transport.html">
<link rel="next" href="eco.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.2/leaflet-providers-plugin.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99618359-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Geocomputation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#how-to-read-this-book"><i class="fa fa-check"></i>How to read this book</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#why-r"><i class="fa fa-check"></i>Why R?</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#real-world-impact"><i class="fa fa-check"></i>Real-world impact</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-geocomputation"><i class="fa fa-check"></i><b>1.1</b> What is geocomputation?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#why-geocomputation-with-r"><i class="fa fa-check"></i><b>1.2</b> Why geocomputation with R?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#software-for-geocomputation"><i class="fa fa-check"></i><b>1.3</b> Software for geocomputation</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#rs-spatial-ecosystem"><i class="fa fa-check"></i><b>1.4</b> R’s spatial ecosystem</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-history-of-r-spatial"><i class="fa fa-check"></i><b>1.5</b> The history of R-spatial</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="2" data-path="spatial-class.html"><a href="spatial-class.html"><i class="fa fa-check"></i><b>2</b> Geographic data in R</a><ul>
<li class="chapter" data-level="" data-path="spatial-class.html"><a href="spatial-class.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="spatial-class.html"><a href="spatial-class.html#vector-data"><i class="fa fa-check"></i><b>2.1</b> Vector data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="spatial-class.html"><a href="spatial-class.html#intro-sf"><i class="fa fa-check"></i><b>2.1.1</b> An introduction to simple features</a></li>
<li class="chapter" data-level="2.1.2" data-path="spatial-class.html"><a href="spatial-class.html#why-simple-features"><i class="fa fa-check"></i><b>2.1.2</b> Why simple features?</a></li>
<li class="chapter" data-level="2.1.3" data-path="spatial-class.html"><a href="spatial-class.html#basic-map"><i class="fa fa-check"></i><b>2.1.3</b> Basic map making</a></li>
<li class="chapter" data-level="2.1.4" data-path="spatial-class.html"><a href="spatial-class.html#base-args"><i class="fa fa-check"></i><b>2.1.4</b> Base plot arguments</a></li>
<li class="chapter" data-level="2.1.5" data-path="spatial-class.html"><a href="spatial-class.html#geometry"><i class="fa fa-check"></i><b>2.1.5</b> Geometry types</a></li>
<li class="chapter" data-level="2.1.6" data-path="spatial-class.html"><a href="spatial-class.html#sfg"><i class="fa fa-check"></i><b>2.1.6</b> Simple feature geometries (sfg)</a></li>
<li class="chapter" data-level="2.1.7" data-path="spatial-class.html"><a href="spatial-class.html#sfc"><i class="fa fa-check"></i><b>2.1.7</b> Simple feature columns (sfc)</a></li>
<li class="chapter" data-level="2.1.8" data-path="spatial-class.html"><a href="spatial-class.html#sf"><i class="fa fa-check"></i><b>2.1.8</b> The sf class</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="spatial-class.html"><a href="spatial-class.html#raster-data"><i class="fa fa-check"></i><b>2.2</b> Raster data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="spatial-class.html"><a href="spatial-class.html#an-introduction-to-raster"><i class="fa fa-check"></i><b>2.2.1</b> An introduction to raster</a></li>
<li class="chapter" data-level="2.2.2" data-path="spatial-class.html"><a href="spatial-class.html#basic-map-raster"><i class="fa fa-check"></i><b>2.2.2</b> Basic map making</a></li>
<li class="chapter" data-level="2.2.3" data-path="spatial-class.html"><a href="spatial-class.html#raster-classes"><i class="fa fa-check"></i><b>2.2.3</b> Raster classes</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="spatial-class.html"><a href="spatial-class.html#crs-intro"><i class="fa fa-check"></i><b>2.3</b> Coordinate Reference Systems</a><ul>
<li class="chapter" data-level="2.3.1" data-path="spatial-class.html"><a href="spatial-class.html#geographic-coordinate-systems"><i class="fa fa-check"></i><b>2.3.1</b> Geographic coordinate systems</a></li>
<li class="chapter" data-level="2.3.2" data-path="spatial-class.html"><a href="spatial-class.html#projected-coordinate-systems"><i class="fa fa-check"></i><b>2.3.2</b> Projected coordinate systems</a></li>
<li class="chapter" data-level="2.3.3" data-path="spatial-class.html"><a href="spatial-class.html#crs-in-r"><i class="fa fa-check"></i><b>2.3.3</b> CRSs in R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="spatial-class.html"><a href="spatial-class.html#units"><i class="fa fa-check"></i><b>2.4</b> Units</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-class.html"><a href="spatial-class.html#ex2"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="attr.html"><a href="attr.html"><i class="fa fa-check"></i><b>3</b> Attribute data operations</a><ul>
<li class="chapter" data-level="" data-path="attr.html"><a href="attr.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="attr.html"><a href="attr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="attr.html"><a href="attr.html#vector-attribute-manipulation"><i class="fa fa-check"></i><b>3.2</b> Vector attribute manipulation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="attr.html"><a href="attr.html#vector-attribute-subsetting"><i class="fa fa-check"></i><b>3.2.1</b> Vector attribute subsetting</a></li>
<li class="chapter" data-level="3.2.2" data-path="attr.html"><a href="attr.html#vector-attribute-aggregation"><i class="fa fa-check"></i><b>3.2.2</b> Vector attribute aggregation</a></li>
<li class="chapter" data-level="3.2.3" data-path="attr.html"><a href="attr.html#vector-attribute-joining"><i class="fa fa-check"></i><b>3.2.3</b> Vector attribute joining</a></li>
<li class="chapter" data-level="3.2.4" data-path="attr.html"><a href="attr.html#vec-attr-creation"><i class="fa fa-check"></i><b>3.2.4</b> Creating attributes and removing spatial information</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="attr.html"><a href="attr.html#manipulating-raster-objects"><i class="fa fa-check"></i><b>3.3</b> Manipulating raster objects</a><ul>
<li class="chapter" data-level="3.3.1" data-path="attr.html"><a href="attr.html#raster-subsetting"><i class="fa fa-check"></i><b>3.3.1</b> Raster subsetting</a></li>
<li class="chapter" data-level="3.3.2" data-path="attr.html"><a href="attr.html#summarizing-raster-objects"><i class="fa fa-check"></i><b>3.3.2</b> Summarizing raster objects</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="attr.html"><a href="attr.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-operations.html"><a href="spatial-operations.html"><i class="fa fa-check"></i><b>4</b> Spatial data operations</a><ul>
<li class="chapter" data-level="" data-path="spatial-operations.html"><a href="spatial-operations.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="spatial-operations.html"><a href="spatial-operations.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-vec"><i class="fa fa-check"></i><b>4.2</b> Spatial operations on vector data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-subsetting"><i class="fa fa-check"></i><b>4.2.1</b> Spatial subsetting</a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-operations.html"><a href="spatial-operations.html#topological-relations"><i class="fa fa-check"></i><b>4.2.2</b> Topological relations</a></li>
<li class="chapter" data-level="4.2.3" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-joining"><i class="fa fa-check"></i><b>4.2.3</b> Spatial joining</a></li>
<li class="chapter" data-level="4.2.4" data-path="spatial-operations.html"><a href="spatial-operations.html#non-overlapping-joins"><i class="fa fa-check"></i><b>4.2.4</b> Non-overlapping joins</a></li>
<li class="chapter" data-level="4.2.5" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-aggr"><i class="fa fa-check"></i><b>4.2.5</b> Spatial data aggregation</a></li>
<li class="chapter" data-level="4.2.6" data-path="spatial-operations.html"><a href="spatial-operations.html#distance-relations"><i class="fa fa-check"></i><b>4.2.6</b> Distance relations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-ras"><i class="fa fa-check"></i><b>4.3</b> Spatial operations on raster data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-raster-subsetting"><i class="fa fa-check"></i><b>4.3.1</b> Spatial subsetting</a></li>
<li class="chapter" data-level="4.3.2" data-path="spatial-operations.html"><a href="spatial-operations.html#map-algebra"><i class="fa fa-check"></i><b>4.3.2</b> Map algebra</a></li>
<li class="chapter" data-level="4.3.3" data-path="spatial-operations.html"><a href="spatial-operations.html#local-operations"><i class="fa fa-check"></i><b>4.3.3</b> Local operations</a></li>
<li class="chapter" data-level="4.3.4" data-path="spatial-operations.html"><a href="spatial-operations.html#focal-operations"><i class="fa fa-check"></i><b>4.3.4</b> Focal operations</a></li>
<li class="chapter" data-level="4.3.5" data-path="spatial-operations.html"><a href="spatial-operations.html#zonal-operations"><i class="fa fa-check"></i><b>4.3.5</b> Zonal operations</a></li>
<li class="chapter" data-level="4.3.6" data-path="spatial-operations.html"><a href="spatial-operations.html#global-operations-and-distances"><i class="fa fa-check"></i><b>4.3.6</b> Global operations and distances</a></li>
<li class="chapter" data-level="4.3.7" data-path="spatial-operations.html"><a href="spatial-operations.html#merging-rasters"><i class="fa fa-check"></i><b>4.3.7</b> Merging rasters</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="spatial-operations.html"><a href="spatial-operations.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="geometric-operations.html"><a href="geometric-operations.html"><i class="fa fa-check"></i><b>5</b> Geometry operations</a><ul>
<li class="chapter" data-level="" data-path="geometric-operations.html"><a href="geometric-operations.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.1" data-path="geometric-operations.html"><a href="geometric-operations.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="geometric-operations.html"><a href="geometric-operations.html#geo-vec"><i class="fa fa-check"></i><b>5.2</b> Geometric operations on vector data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="geometric-operations.html"><a href="geometric-operations.html#simplification"><i class="fa fa-check"></i><b>5.2.1</b> Simplification</a></li>
<li class="chapter" data-level="5.2.2" data-path="geometric-operations.html"><a href="geometric-operations.html#centroids"><i class="fa fa-check"></i><b>5.2.2</b> Centroids</a></li>
<li class="chapter" data-level="5.2.3" data-path="geometric-operations.html"><a href="geometric-operations.html#buffers"><i class="fa fa-check"></i><b>5.2.3</b> Buffers</a></li>
<li class="chapter" data-level="5.2.4" data-path="geometric-operations.html"><a href="geometric-operations.html#affine-transformations"><i class="fa fa-check"></i><b>5.2.4</b> Affine transformations</a></li>
<li class="chapter" data-level="5.2.5" data-path="geometric-operations.html"><a href="geometric-operations.html#clipping"><i class="fa fa-check"></i><b>5.2.5</b> Clipping</a></li>
<li class="chapter" data-level="5.2.6" data-path="geometric-operations.html"><a href="geometric-operations.html#geometry-unions"><i class="fa fa-check"></i><b>5.2.6</b> Geometry unions</a></li>
<li class="chapter" data-level="5.2.7" data-path="geometric-operations.html"><a href="geometric-operations.html#type-trans"><i class="fa fa-check"></i><b>5.2.7</b> Type transformations</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="geometric-operations.html"><a href="geometric-operations.html#geo-ras"><i class="fa fa-check"></i><b>5.3</b> Geometric operations on raster data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="geometric-operations.html"><a href="geometric-operations.html#geometric-intersections"><i class="fa fa-check"></i><b>5.3.1</b> Geometric intersections</a></li>
<li class="chapter" data-level="5.3.2" data-path="geometric-operations.html"><a href="geometric-operations.html#extent-and-origin"><i class="fa fa-check"></i><b>5.3.2</b> Extent and origin</a></li>
<li class="chapter" data-level="5.3.3" data-path="geometric-operations.html"><a href="geometric-operations.html#aggregation-and-disaggregation"><i class="fa fa-check"></i><b>5.3.3</b> Aggregation and disaggregation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="geometric-operations.html"><a href="geometric-operations.html#raster-vector"><i class="fa fa-check"></i><b>5.4</b> Raster-vector interactions</a><ul>
<li class="chapter" data-level="5.4.1" data-path="geometric-operations.html"><a href="geometric-operations.html#raster-cropping"><i class="fa fa-check"></i><b>5.4.1</b> Raster cropping</a></li>
<li class="chapter" data-level="5.4.2" data-path="geometric-operations.html"><a href="geometric-operations.html#raster-extraction"><i class="fa fa-check"></i><b>5.4.2</b> Raster extraction</a></li>
<li class="chapter" data-level="5.4.3" data-path="geometric-operations.html"><a href="geometric-operations.html#rasterization"><i class="fa fa-check"></i><b>5.4.3</b> Rasterization</a></li>
<li class="chapter" data-level="5.4.4" data-path="geometric-operations.html"><a href="geometric-operations.html#spatial-vectorization"><i class="fa fa-check"></i><b>5.4.4</b> Spatial vectorization</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="geometric-operations.html"><a href="geometric-operations.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html"><i class="fa fa-check"></i><b>6</b> Reprojecting geographic data</a><ul>
<li class="chapter" data-level="" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="6.1" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#when-to-reproject"><i class="fa fa-check"></i><b>6.2</b> When to reproject?</a></li>
<li class="chapter" data-level="6.3" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#which-crs-to-use"><i class="fa fa-check"></i><b>6.3</b> Which CRS to use?</a></li>
<li class="chapter" data-level="6.4" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#reproj-vec-geom"><i class="fa fa-check"></i><b>6.4</b> Reprojecting vector geometries</a></li>
<li class="chapter" data-level="6.5" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#modifying-map-projections"><i class="fa fa-check"></i><b>6.5</b> Modifying map projections</a></li>
<li class="chapter" data-level="6.6" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#reprojecting-raster-geometries"><i class="fa fa-check"></i><b>6.6</b> Reprojecting raster geometries</a></li>
<li class="chapter" data-level="6.7" data-path="reproj-geo-data.html"><a href="reproj-geo-data.html#exercises-4"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="read-write.html"><a href="read-write.html"><i class="fa fa-check"></i><b>7</b> Geographic data I/O</a><ul>
<li class="chapter" data-level="" data-path="read-write.html"><a href="read-write.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="7.1" data-path="read-write.html"><a href="read-write.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="read-write.html"><a href="read-write.html#retrieving-data"><i class="fa fa-check"></i><b>7.2</b> Retrieving open data</a></li>
<li class="chapter" data-level="7.3" data-path="read-write.html"><a href="read-write.html#geographic-data-packages"><i class="fa fa-check"></i><b>7.3</b> Geographic data packages</a></li>
<li class="chapter" data-level="7.4" data-path="read-write.html"><a href="read-write.html#file-formats"><i class="fa fa-check"></i><b>7.4</b> File formats</a></li>
<li class="chapter" data-level="7.5" data-path="read-write.html"><a href="read-write.html#data-input"><i class="fa fa-check"></i><b>7.5</b> Data Input (I)</a><ul>
<li class="chapter" data-level="7.5.1" data-path="read-write.html"><a href="read-write.html#vector-data-1"><i class="fa fa-check"></i><b>7.5.1</b> Vector data</a></li>
<li class="chapter" data-level="7.5.2" data-path="read-write.html"><a href="read-write.html#raster-data-1"><i class="fa fa-check"></i><b>7.5.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="read-write.html"><a href="read-write.html#data-output"><i class="fa fa-check"></i><b>7.6</b> Data output (O)</a><ul>
<li class="chapter" data-level="7.6.1" data-path="read-write.html"><a href="read-write.html#vector-data-2"><i class="fa fa-check"></i><b>7.6.1</b> Vector data</a></li>
<li class="chapter" data-level="7.6.2" data-path="read-write.html"><a href="read-write.html#raster-data-2"><i class="fa fa-check"></i><b>7.6.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="read-write.html"><a href="read-write.html#visual-outputs"><i class="fa fa-check"></i><b>7.7</b> Visual outputs</a></li>
<li class="chapter" data-level="7.8" data-path="read-write.html"><a href="read-write.html#exercises-5"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Extensions</b></span></li>
<li class="chapter" data-level="8" data-path="adv-map.html"><a href="adv-map.html"><i class="fa fa-check"></i><b>8</b> Making maps with R</a><ul>
<li class="chapter" data-level="" data-path="adv-map.html"><a href="adv-map.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="8.1" data-path="adv-map.html"><a href="adv-map.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="adv-map.html"><a href="adv-map.html#static-maps"><i class="fa fa-check"></i><b>8.2</b> Static maps</a><ul>
<li class="chapter" data-level="8.2.1" data-path="adv-map.html"><a href="adv-map.html#tmap-basics"><i class="fa fa-check"></i><b>8.2.1</b> tmap basics</a></li>
<li class="chapter" data-level="8.2.2" data-path="adv-map.html"><a href="adv-map.html#map-obj"><i class="fa fa-check"></i><b>8.2.2</b> Map objects</a></li>
<li class="chapter" data-level="8.2.3" data-path="adv-map.html"><a href="adv-map.html#aesthetics"><i class="fa fa-check"></i><b>8.2.3</b> Aesthetics</a></li>
<li class="chapter" data-level="8.2.4" data-path="adv-map.html"><a href="adv-map.html#color-settings"><i class="fa fa-check"></i><b>8.2.4</b> Color settings</a></li>
<li class="chapter" data-level="8.2.5" data-path="adv-map.html"><a href="adv-map.html#layouts"><i class="fa fa-check"></i><b>8.2.5</b> Layouts</a></li>
<li class="chapter" data-level="8.2.6" data-path="adv-map.html"><a href="adv-map.html#faceted-maps"><i class="fa fa-check"></i><b>8.2.6</b> Faceted maps</a></li>
<li class="chapter" data-level="8.2.7" data-path="adv-map.html"><a href="adv-map.html#inset-maps"><i class="fa fa-check"></i><b>8.2.7</b> Inset maps</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="adv-map.html"><a href="adv-map.html#animated-maps"><i class="fa fa-check"></i><b>8.3</b> Animated maps</a></li>
<li class="chapter" data-level="8.4" data-path="adv-map.html"><a href="adv-map.html#interactive-maps"><i class="fa fa-check"></i><b>8.4</b> Interactive maps</a></li>
<li class="chapter" data-level="8.5" data-path="adv-map.html"><a href="adv-map.html#mapping-applications"><i class="fa fa-check"></i><b>8.5</b> Mapping applications</a></li>
<li class="chapter" data-level="8.6" data-path="adv-map.html"><a href="adv-map.html#other-mapping-packages"><i class="fa fa-check"></i><b>8.6</b> Other mapping packages</a></li>
<li class="chapter" data-level="8.7" data-path="adv-map.html"><a href="adv-map.html#exercises-6"><i class="fa fa-check"></i><b>8.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="gis.html"><a href="gis.html"><i class="fa fa-check"></i><b>9</b> Bridges to GIS software</a><ul>
<li class="chapter" data-level="" data-path="gis.html"><a href="gis.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="9.1" data-path="gis.html"><a href="gis.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="gis.html"><a href="gis.html#rqgis"><i class="fa fa-check"></i><b>9.2</b> (R)QGIS</a></li>
<li class="chapter" data-level="9.3" data-path="gis.html"><a href="gis.html#rsaga"><i class="fa fa-check"></i><b>9.3</b> (R)SAGA</a></li>
<li class="chapter" data-level="9.4" data-path="gis.html"><a href="gis.html#rgrass"><i class="fa fa-check"></i><b>9.4</b> GRASS through <strong>rgrass7</strong></a></li>
<li class="chapter" data-level="9.5" data-path="gis.html"><a href="gis.html#when-to-use-what"><i class="fa fa-check"></i><b>9.5</b> When to use what?</a></li>
<li class="chapter" data-level="9.6" data-path="gis.html"><a href="gis.html#other-bridges"><i class="fa fa-check"></i><b>9.6</b> Other bridges</a><ul>
<li class="chapter" data-level="9.6.1" data-path="gis.html"><a href="gis.html#gdal"><i class="fa fa-check"></i><b>9.6.1</b> Bridges to GDAL</a></li>
<li class="chapter" data-level="9.6.2" data-path="gis.html"><a href="gis.html#postgis"><i class="fa fa-check"></i><b>9.6.2</b> Bridges to spatial databases</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="gis.html"><a href="gis.html#exercises-7"><i class="fa fa-check"></i><b>9.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="algorithms.html"><a href="algorithms.html"><i class="fa fa-check"></i><b>10</b> Scripts, algorithms and functions</a><ul>
<li class="chapter" data-level="" data-path="algorithms.html"><a href="algorithms.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="10.1" data-path="algorithms.html"><a href="algorithms.html#intro-algorithms"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="algorithms.html"><a href="algorithms.html#scripts"><i class="fa fa-check"></i><b>10.2</b> Scripts</a></li>
<li class="chapter" data-level="10.3" data-path="algorithms.html"><a href="algorithms.html#geographic-algorithms"><i class="fa fa-check"></i><b>10.3</b> Geographic algorithms</a></li>
<li class="chapter" data-level="10.4" data-path="algorithms.html"><a href="algorithms.html#functions"><i class="fa fa-check"></i><b>10.4</b> Functions</a></li>
<li class="chapter" data-level="10.5" data-path="algorithms.html"><a href="algorithms.html#ex-algorithms"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-cv.html"><a href="spatial-cv.html"><i class="fa fa-check"></i><b>11</b> Statistical learning</a><ul>
<li class="chapter" data-level="" data-path="spatial-cv.html"><a href="spatial-cv.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="11.1" data-path="spatial-cv.html"><a href="spatial-cv.html#intro-cv1"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="spatial-cv.html"><a href="spatial-cv.html#case-landslide"><i class="fa fa-check"></i><b>11.2</b> Case study: Landslide susceptibility</a></li>
<li class="chapter" data-level="11.3" data-path="spatial-cv.html"><a href="spatial-cv.html#conventional-model"><i class="fa fa-check"></i><b>11.3</b> Conventional modeling approach in R</a></li>
<li class="chapter" data-level="11.4" data-path="spatial-cv.html"><a href="spatial-cv.html#intro-cv"><i class="fa fa-check"></i><b>11.4</b> Introduction to (spatial) cross-validation</a></li>
<li class="chapter" data-level="11.5" data-path="spatial-cv.html"><a href="spatial-cv.html#spatial-cv-with-mlr"><i class="fa fa-check"></i><b>11.5</b> Spatial CV with <strong>mlr</strong></a><ul>
<li class="chapter" data-level="11.5.1" data-path="spatial-cv.html"><a href="spatial-cv.html#glm"><i class="fa fa-check"></i><b>11.5.1</b> Generalized linear model</a></li>
<li class="chapter" data-level="11.5.2" data-path="spatial-cv.html"><a href="spatial-cv.html#svm"><i class="fa fa-check"></i><b>11.5.2</b> Spatial tuning of machine-learning hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="spatial-cv.html"><a href="spatial-cv.html#conclusions"><i class="fa fa-check"></i><b>11.6</b> Conclusions</a></li>
<li class="chapter" data-level="11.7" data-path="spatial-cv.html"><a href="spatial-cv.html#exercises-8"><i class="fa fa-check"></i><b>11.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Applications</b></span></li>
<li class="chapter" data-level="12" data-path="transport.html"><a href="transport.html"><i class="fa fa-check"></i><b>12</b> Transportation</a><ul>
<li class="chapter" data-level="" data-path="transport.html"><a href="transport.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="12.1" data-path="transport.html"><a href="transport.html#introduction-7"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="transport.html"><a href="transport.html#bris-case"><i class="fa fa-check"></i><b>12.2</b> A case study of Bristol</a></li>
<li class="chapter" data-level="12.3" data-path="transport.html"><a href="transport.html#transport-zones"><i class="fa fa-check"></i><b>12.3</b> Transport zones</a></li>
<li class="chapter" data-level="12.4" data-path="transport.html"><a href="transport.html#desire-lines"><i class="fa fa-check"></i><b>12.4</b> Desire lines</a></li>
<li class="chapter" data-level="12.5" data-path="transport.html"><a href="transport.html#routes"><i class="fa fa-check"></i><b>12.5</b> Routes</a></li>
<li class="chapter" data-level="12.6" data-path="transport.html"><a href="transport.html#nodes"><i class="fa fa-check"></i><b>12.6</b> Nodes</a></li>
<li class="chapter" data-level="12.7" data-path="transport.html"><a href="transport.html#route-networks"><i class="fa fa-check"></i><b>12.7</b> Route networks</a></li>
<li class="chapter" data-level="12.8" data-path="transport.html"><a href="transport.html#prioritizing-new-infrastructure"><i class="fa fa-check"></i><b>12.8</b> Prioritizing new infrastructure</a></li>
<li class="chapter" data-level="12.9" data-path="transport.html"><a href="transport.html#future-directions-of-travel"><i class="fa fa-check"></i><b>12.9</b> Future directions of travel</a></li>
<li class="chapter" data-level="12.10" data-path="transport.html"><a href="transport.html#ex-transport"><i class="fa fa-check"></i><b>12.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="location.html"><a href="location.html"><i class="fa fa-check"></i><b>13</b> Geomarketing</a><ul>
<li class="chapter" data-level="" data-path="location.html"><a href="location.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="13.1" data-path="location.html"><a href="location.html#introduction-8"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="location.html"><a href="location.html#case-study"><i class="fa fa-check"></i><b>13.2</b> Case study: bike shops in Germany</a></li>
<li class="chapter" data-level="13.3" data-path="location.html"><a href="location.html#tidy-the-input-data"><i class="fa fa-check"></i><b>13.3</b> Tidy the input data</a></li>
<li class="chapter" data-level="13.4" data-path="location.html"><a href="location.html#create-census-rasters"><i class="fa fa-check"></i><b>13.4</b> Create census rasters</a></li>
<li class="chapter" data-level="13.5" data-path="location.html"><a href="location.html#define-metropolitan-areas"><i class="fa fa-check"></i><b>13.5</b> Define metropolitan areas</a></li>
<li class="chapter" data-level="13.6" data-path="location.html"><a href="location.html#points-of-interest"><i class="fa fa-check"></i><b>13.6</b> Points of interest</a></li>
<li class="chapter" data-level="13.7" data-path="location.html"><a href="location.html#identifying-suitable-locations"><i class="fa fa-check"></i><b>13.7</b> Identifying suitable locations</a></li>
<li class="chapter" data-level="13.8" data-path="location.html"><a href="location.html#discussion-and-next-steps"><i class="fa fa-check"></i><b>13.8</b> Discussion and next steps</a></li>
<li class="chapter" data-level="13.9" data-path="location.html"><a href="location.html#exercises-9"><i class="fa fa-check"></i><b>13.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="eco.html"><a href="eco.html"><i class="fa fa-check"></i><b>14</b> Ecology</a><ul>
<li class="chapter" data-level="" data-path="eco.html"><a href="eco.html#prerequisites-12"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="14.1" data-path="eco.html"><a href="eco.html#introduction-9"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="eco.html"><a href="eco.html#data-and-data-preparation"><i class="fa fa-check"></i><b>14.2</b> Data and data preparation</a></li>
<li class="chapter" data-level="14.3" data-path="eco.html"><a href="eco.html#nmds"><i class="fa fa-check"></i><b>14.3</b> Reducing dimensionality</a></li>
<li class="chapter" data-level="14.4" data-path="eco.html"><a href="eco.html#modeling-the-floristic-gradient"><i class="fa fa-check"></i><b>14.4</b> Modeling the floristic gradient</a><ul>
<li class="chapter" data-level="14.4.1" data-path="eco.html"><a href="eco.html#mlr-building-blocks"><i class="fa fa-check"></i><b>14.4.1</b> <strong>mlr</strong> building blocks</a></li>
<li class="chapter" data-level="14.4.2" data-path="eco.html"><a href="eco.html#predictive-mapping"><i class="fa fa-check"></i><b>14.4.2</b> Predictive mapping</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="eco.html"><a href="eco.html#conclusions-1"><i class="fa fa-check"></i><b>14.5</b> Conclusions</a></li>
<li class="chapter" data-level="14.6" data-path="eco.html"><a href="eco.html#exercises-10"><i class="fa fa-check"></i><b>14.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>15</b> Conclusion</a><ul>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html#prerequisites-13"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="15.1" data-path="conclusion.html"><a href="conclusion.html#package-choice"><i class="fa fa-check"></i><b>15.1</b> Package choice</a></li>
<li class="chapter" data-level="15.2" data-path="conclusion.html"><a href="conclusion.html#gaps"><i class="fa fa-check"></i><b>15.2</b> Gaps and overlaps</a></li>
<li class="chapter" data-level="15.3" data-path="conclusion.html"><a href="conclusion.html#next"><i class="fa fa-check"></i><b>15.3</b> Where next?</a></li>
<li class="chapter" data-level="15.4" data-path="conclusion.html"><a href="conclusion.html#benefit"><i class="fa fa-check"></i><b>15.4</b> Geo* for social benefit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://robinlovelace.net/">Robin Lovelace</a></li>
<li><a href="https://nowosad.github.io/">Jakub Nowosad</a></li>
<li><a href="http://www.geographie.uni-jena.de/en/Muenchow.html">Jannes Muenchow</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Geocomputation with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="location" class="section level1">
<h1><span class="header-section-number">13</span> Geomarketing</h1>
<div id="prerequisites-11" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<ul>
<li>This chapter requires the following packages (<strong>revgeo</strong> must also be installed):</li>
</ul>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb416-2" data-line-number="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb416-3" data-line-number="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb416-4" data-line-number="4"><span class="kw">library</span>(osmdata)</a>
<a class="sourceLine" id="cb416-5" data-line-number="5"><span class="kw">library</span>(spDataLarge)</a></code></pre></div>
<ul>
<li>Required data will be downloaded in due course.
As a convenience to the reader and to ensure easy reproducibility we have made available the downloaded data in the <strong>spDataLarge</strong> package.</li>
</ul>
</div>
<div id="introduction-8" class="section level2">
<h2><span class="header-section-number">13.1</span> Introduction</h2>
<p>This chapter demonstrates how the skills learned in Part I can be applied to a particular domain: geomarketing (sometimes also referred to as location analysis or location intelligence).
This is a broad field of research and commercial application.
A typical example is where to locate a new shop.
The aim here is to attract most visitors and, ultimately, make most profit.
There are also many non-commercial applications that can use the technique for public benefit, for example where to locate new health services <span class="citation">(Tomintz, Clarke, and Rigby <a href="#ref-tomintz_geography_2008">2008</a>)</span>.</p>
<p>People are fundamental to location analysis, in particular where they are likely to spend their time and other resources.
Interestingly, ecological concepts and models are quite similar to those used for store location analysis.
Animals and plants can best meet their needs in certain ‘optimal’ locations, based on variables that change over space (<span class="citation">Muenchow et al. (<a href="#ref-muenchow_review_2018">2018</a>)</span><!--; see also chapter \@ref(eco)-->) .
This is one of the great strengths of geocomputation and GIScience in general.
Concepts and methods are transferable to other fields.
<!-- add reference!! -->
Polar bears, for example, prefer northern latitudes where temperatures are lower and food (seals and sea lions) is plentiful.
Similarly, humans tend to congregate certain places, creating economic niches (and high land prices) analogous to the ecological niche of the Arctic.
The main task of location analysis is to find out where such ‘optimal locations’ are for specific services, based on available data.
Typical research questions include:</p>
<ul>
<li>Where do target groups live and which areas do they frequent?</li>
<li>Where are competing stores or services located?</li>
<li>How many people can easily reach specific stores?</li>
<li>Do existing services over or under-exploit the market potential?</li>
<li>What is the market share of a company in a specific area?</li>
</ul>
<p>This chapter demonstrates how geocomputation can answer such questions based on a hypothetical case study based on real data.</p>
</div>
<div id="case-study" class="section level2">
<h2><span class="header-section-number">13.2</span> Case study: bike shops in Germany</h2>
<p>Imagine you are starting a chain of bike shops in Germany.
The stores should be placed in urban areas with as many potential customers as possible.
Additionally, a hypothetical survey (invented for this chapter not for commercial use!) suggests that single young males (aged 20 to 40) are most likely to buy your products: this is the <em>target audience</em>.
You are in the lucky position to have sufficient capital to open a number of shops.
But where should they be placed?
Consulting companies (employing geomarketing analysts) would happily charge high rates to answer such questions.
Luckily, we can do so ourselves with the help of open data and open source software.
The following sections will demonstrate how the techniques learned during the first chapters of the book can be applied to undertake the following steps:</p>
<ul>
<li>Tidy the input data from the German census (section <a href="location.html#tidy-the-input-data">13.3</a>).</li>
<li>Convert the tabulated census data into raster objects (section <a href="location.html#create-census-rasters">13.4</a>).</li>
<li>Identify metropolitan areas with high population densities (section <a href="location.html#define-metropolitan-areas">13.5</a>).</li>
<li>Download detailed geographic data (from OpenStreetMap, with <strong>osmdata</strong>) for these areas (section <a href="location.html#points-of-interest">13.6</a>).</li>
<li>Create rasters for scoring the relative desirability of different locations using map algebra (section <a href="location.html#identifying-suitable-locations">13.7</a>).</li>
</ul>
<p>Although we have applied these steps to a specific case study, they could be generalized to many scenarios of store location or public service provision.</p>
</div>
<div id="tidy-the-input-data" class="section level2">
<h2><span class="header-section-number">13.3</span> Tidy the input data</h2>
<p>The German government provides gridded census data at either 1 km or 100 m resolution.
The following code chunk downloads, unzips and reads-in the 1 km data.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1"><span class="kw">download.file</span>(<span class="st">&quot;https://tinyurl.com/ybtpkwxz&quot;</span>, </a>
<a class="sourceLine" id="cb417-2" data-line-number="2">              <span class="dt">destfile =</span> <span class="st">&quot;census.zip&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>)</a>
<a class="sourceLine" id="cb417-3" data-line-number="3"><span class="kw">unzip</span>(<span class="st">&quot;census.zip&quot;</span>) <span class="co"># unzip the files</span></a>
<a class="sourceLine" id="cb417-4" data-line-number="4">census_de =<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv2</span>(<span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;Gitter.csv&quot;</span>))</a></code></pre></div>
<p>As a convenience to the reader, the corresponding data has been put into <strong>spDataLarge</strong> and can be accessed as follows</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;census_de&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a></code></pre></div>
<p>The <code>census_de</code> object is a data frame containing 13 variables for more than 300,000 grid cells across Germany.
For our work we only need a subset of these: Easting (<code>x</code>) and Northing (<code>y</code>), number of inhabitants (population; <code>pop</code>), mean average age (<code>mean_age</code>), proportion of women (<code>women</code>) and average household size (<code>hh_size</code>).
These variables are selected and renamed from German into English in the code chunk below and summarized in Table <a href="location.html#tab:census-desc">13.1</a>.
Further, <code>mutate_all()</code> is used to convert values -1 and -9 (meaning unknown) to <code>NA</code>.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1"><span class="co"># pop = population, hh_size = household size</span></a>
<a class="sourceLine" id="cb419-2" data-line-number="2">input =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(census_de, <span class="dt">x =</span> x_mp_1km, <span class="dt">y =</span> y_mp_1km, <span class="dt">pop =</span> Einwohner,</a>
<a class="sourceLine" id="cb419-3" data-line-number="3">                      <span class="dt">women =</span> Frauen_A, <span class="dt">mean_age =</span> Alter_D,</a>
<a class="sourceLine" id="cb419-4" data-line-number="4">                      <span class="dt">hh_size =</span> HHGroesse_D)</a>
<a class="sourceLine" id="cb419-5" data-line-number="5"><span class="co"># set -1 and -9 to NA</span></a>
<a class="sourceLine" id="cb419-6" data-line-number="6">input_tidy =<span class="st"> </span><span class="kw">mutate_all</span>(input, <span class="kw">funs</span>(<span class="kw">ifelse</span>(. <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-9</span>), <span class="ot">NA</span>, .)))</a></code></pre></div>
<table>
<caption><span id="tab:census-desc">Table 13.1: </span>Categories for each variable in Census data from ‘Datensatzbeschreibung…xlsx’ located in the downloaded file census.zip. See Figure 13.1 for their spatial distribution.</caption>
<thead>
<tr class="header">
<th align="center">class</th>
<th align="center">Population</th>
<th align="center">% female</th>
<th align="center">Mean age</th>
<th align="center">Household size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">3-250</td>
<td align="center">0-40</td>
<td align="center">0-40</td>
<td align="center">1-2</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">250-500</td>
<td align="center">40-47</td>
<td align="center">40-42</td>
<td align="center">2-2.5</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">500-2000</td>
<td align="center">47-53</td>
<td align="center">42-44</td>
<td align="center">2.5-3</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">2000-4000</td>
<td align="center">53-60</td>
<td align="center">44-47</td>
<td align="center">3-3.5</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">4000-8000</td>
<td align="center">&gt;60</td>
<td align="center">&gt;47</td>
<td align="center">&gt;3.5</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">&gt;8000</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div id="create-census-rasters" class="section level2">
<h2><span class="header-section-number">13.4</span> Create census rasters</h2>
<p>After the preprocessing, the data can be converted into a raster stack or brick (see sections <a href="spatial-class.html#raster-classes">2.2.3</a> and <a href="attr.html#raster-subsetting">3.3.1</a>).
<code>rasterFromXYZ()</code> makes this really easy.
It requires an input data frame where the first two columns represent coordinates on a regular grid.
All the remaining columns (here: <code>pop</code>, <code>women</code>, <code>mean_age</code>, <code>hh_size</code>) will serve as input for the raster brick layers (Figure <a href="location.html#fig:census-stack">13.1</a>; see also <code>code/13-location-jm.R</code>).</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1">input_ras =<span class="st"> </span><span class="kw">rasterFromXYZ</span>(input_tidy, <span class="dt">crs =</span> <span class="kw">st_crs</span>(<span class="dv">3035</span>)<span class="op">$</span>proj4string)</a></code></pre></div>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1">input_ras</a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="co">#&gt; class : RasterBrick</span></a>
<a class="sourceLine" id="cb421-3" data-line-number="3"><span class="co">#&gt; dimensions : 868, 642, 557256, 4 (nrow, ncol, ncell, nlayers)</span></a>
<a class="sourceLine" id="cb421-4" data-line-number="4"><span class="co">#&gt; resolution : 1000, 1000 (x, y)</span></a>
<a class="sourceLine" id="cb421-5" data-line-number="5"><span class="co">#&gt; extent : 4031000, 4673000, 2684000, 3552000 (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb421-6" data-line-number="6"><span class="co">#&gt; coord. ref. : +proj=laea +lat_0=52 +lon_0=10</span></a>
<a class="sourceLine" id="cb421-7" data-line-number="7"><span class="co">#&gt; names       :  pop, women, mean_age, hh_size </span></a>
<a class="sourceLine" id="cb421-8" data-line-number="8"><span class="co">#&gt; min values  :  127,     0,        0,       0 </span></a>
<a class="sourceLine" id="cb421-9" data-line-number="9"><span class="co">#&gt; max values  : 8000,     3,        3,       3 </span></a></code></pre></div>

<div class="rmdnote">
Note that we are using an equal-area projection (EPSG:3035; Lambert Equal Area Europe), i.e. a projected CRS where each grid cell has the same area, here 1000 x 1000 square meters.
Since we are using mainly densities such as the number of inhabitants or the portion of women per grid cell, it is of utmost importance that the area of each grid cell is the same to avoid ‘comparing apples and oranges’.
Be careful with geographic CRS where grid cell areas constantly decrease in poleward directions (see also sections <a href="spatial-class.html#crs-intro">2.3</a> and <a href="reproj-geo-data.html#reproj-geo-data">6</a>).
</div>

<div class="figure" style="text-align: center"><span id="fig:census-stack"></span>
<img src="figures/08_census_stack.png" alt="Gridded German census data of 2011. See Table 13.1 for a description of the classes." width="765" />
<p class="caption">
Figure 13.1: Gridded German census data of 2011. See Table 13.1 for a description of the classes.
</p>
</div>
<!-- find out about new lines in headings + blank cells-->
<p>The next stage is to reclassify the values of the rasters stored in <code>input_ras</code> in accordance with the survey mentioned in section <a href="location.html#case-study">13.2</a>, using the <strong>raster</strong> function <code>reclassify()</code>, which was introduced in section <a href="spatial-operations.html#local-operations">4.3.3</a>.
In the case of the population data we convert the classes into a numeric data type using class means.
Raster cells are assumed to have a population of 127 if they have a value of 1 (cells in ‘class 1’ contain between 3 and 250 inhabitants) and 375 if they have a value of 2 (containing 250 to 500 inhabitants), and so on (see Table <a href="location.html#tab:census-desc">13.1</a>).
A cell value of 8000 inhabitants was chosen for ‘class 6’ because these cells contain more than 8000 people.
Of course, these are approximations of the true population, not precise values.<a href="#fn74" class="footnote-ref" id="fnref74"><sup>74</sup></a>
However, the level of detail is sufficient to delineate metropolitan areas (see next section).</p>
<p>In contrast to the <code>pop</code> variable, representing absolute estimates of the total population, the remaining variables were re-classified as weights corresponding with weights used in the survey.
Class 1 in the variable <code>women</code>, for instance, represents areas in which 0 to 40% of the population is female;
these are reclassified with a comparatively high weight of 3 because the target demographic is predominantly male.
Similarly, the classes containing the youngest people and highest proportion of single households are reclassified to have high weights.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1">rcl_pop =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">127</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">375</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1250</span>, </a>
<a class="sourceLine" id="cb422-2" data-line-number="2">                   <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3000</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6000</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">8000</span>), </a>
<a class="sourceLine" id="cb422-3" data-line-number="3">                 <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb422-4" data-line-number="4">rcl_women =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb422-5" data-line-number="5">                   <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb422-6" data-line-number="6">rcl_age =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb422-7" data-line-number="7">                 <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb422-8" data-line-number="8">rcl_hh =<span class="st"> </span>rcl_women</a>
<a class="sourceLine" id="cb422-9" data-line-number="9">rcl =<span class="st"> </span><span class="kw">list</span>(rcl_pop, rcl_women, rcl_age, rcl_hh)</a></code></pre></div>
<p>Note that we have made sure that the order of the reclassification matrices in the list is the same as for the elements of <code>input_ras</code>.
For instance, the first element corresponds in both cases to the population.
Subsequently, the <code>for</code>-loop applies the reclassification matrix to the corresponding raster layer.
Finally, the code chunk below ensures the <code>reclass</code> layers have the same name as the layers of <code>input_ras</code>.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1">reclass =<span class="st"> </span>input_ras</a>
<a class="sourceLine" id="cb423-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>raster<span class="op">::</span><span class="kw">nlayers</span>(reclass)) {</a>
<a class="sourceLine" id="cb423-3" data-line-number="3">  reclass[[i]] =<span class="st"> </span><span class="kw">reclassify</span>(<span class="dt">x =</span> reclass[[i]], <span class="dt">rcl =</span> rcl[[i]], <span class="dt">right =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb423-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb423-5" data-line-number="5"><span class="kw">names</span>(reclass) =<span class="st"> </span><span class="kw">names</span>(input_ras)</a></code></pre></div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1">reclass</a>
<a class="sourceLine" id="cb424-2" data-line-number="2"><span class="co">#&gt; ... (full output not shown)</span></a>
<a class="sourceLine" id="cb424-3" data-line-number="3"><span class="co">#&gt; names       :  pop, women, mean_age, hh_size </span></a>
<a class="sourceLine" id="cb424-4" data-line-number="4"><span class="co">#&gt; min values  :  127,     0,        0,       0 </span></a>
<a class="sourceLine" id="cb424-5" data-line-number="5"><span class="co">#&gt; max values  : 8000,     3,        3,       3</span></a></code></pre></div>
</div>
<div id="define-metropolitan-areas" class="section level2">
<h2><span class="header-section-number">13.5</span> Define metropolitan areas</h2>
<p>We define metropolitan areas as pixels of 20 km<sup>2</sup> inhabited by more than 500,000 people.
Pixels at this coarse resolution can rapidly be created using <code>aggregate()</code>, as introduced in section <a href="geometric-operations.html#aggregation-and-disaggregation">5.3.3</a>.
The command below uses the argument <code>fact = 20</code> to reduce the resolution of the result twenty-fold (recall the original raster resolution was 1 km<sup>2</sup>):</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1">pop_agg =<span class="st"> </span><span class="kw">aggregate</span>(reclass<span class="op">$</span>pop, <span class="dt">fact =</span> <span class="dv">20</span>, <span class="dt">fun =</span> sum)</a></code></pre></div>
<p>The next stage is to keep only cells with more than half a million people.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1">pop_agg =<span class="st"> </span>pop_agg[pop_agg <span class="op">&gt;</span><span class="st"> </span><span class="dv">500000</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>] </a></code></pre></div>
<p>Plotting this reveals eight metropolitan regions (Fig. <a href="location.html#fig:metro-areas">13.2</a>).
Each region consists of one or more raster cells.
It would be nice if we could join all cells belonging to one region.
<strong>raster</strong>’s <code>clump()</code> command does exactly that.
Subsequently, <code>rasterToPolygons()</code> converts the raster object into spatial polygons, and <code>st_as_sf()</code> converts it into an <code>sf</code>-object.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1">polys =<span class="st"> </span>pop_agg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb427-2" data-line-number="2"><span class="st">  </span><span class="kw">clump</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-3" data-line-number="3"><span class="st">  </span><span class="kw">rasterToPolygons</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-4" data-line-number="4"><span class="st">  </span><span class="kw">st_as_sf</span>()</a></code></pre></div>
<p><code>polys</code> now features a column named <code>clumps</code> which indicates to which metropolitan region each polygon belongs and which we will use to dissolve the polygons into coherent single regions (see also section <a href="geometric-operations.html#geometry-unions">5.2.6</a>):</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1">metros =<span class="st"> </span>polys <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb428-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(clumps) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb428-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>()</a></code></pre></div>
<p>Given no other column as input, <code>summarize()</code> only dissolves the geometry.</p>
<!-- maybe a good if advanced exercise
This requires finding the nearest neighbors (`st_intersects()`), and some additional processing.
Do not worry too much about the following code.
There is probably a better way to do it. 
Nevertheless, it finds all pixels belonging to one region in a generic way.
We use this information to assign each polygon (pixel) to a region.
Subsequently, we can use the region information to dissolve the pixels into region polygons.


```r
# dissolve on spatial neighborhood
nbs = st_intersects(polys, polys)
# nbs = over(polys, polys, returnList = TRUE)

fun = function(x, y) {
  tmp = lapply(y, function(i) {
  if (any(x %in% i)) {
   union(x, i)
  } else {
   x
    }
  })
  Reduce(union, tmp)
}
# call function recursively
fun_2 = function(x, y) {
  out = fun(x, y)
  while (length(out) < length(fun(out, y))) {
    out = fun(out, y)
  }
  out
}

cluster = map(nbs, ~ fun_2(., nbs) %>% sort)
# just keep unique clusters
cluster = cluster[!duplicated(cluster)]
# assign the cluster classes to each pixel
for (i in seq_along(cluster)) {
  polys[cluster[[i]], "region_id"] = i
}
# dissolve pixels based on the the region id
polys = group_by(polys, region_id) %>%
  summarize(pop = sum(layer, na.rm = TRUE))
# polys_2 = aggregate(polys, list(polys$region_id), sum)
plot(polys[, "region_id"])

# Another approach, can be also be part of an excercise

coords = st_coordinates(polys_3) %>% 
  as.data.frame
ls = split(coords, f = coords$L2)
ls = lapply(ls, function(x) {
  dplyr::select(x, X, Y) %>%
    as.matrix %>%
    list %>%
    st_polygon
})
metros = do.call(st_sfc, ls)
metros = st_set_crs(metros, 3035)
metros = st_sf(data.frame(region_id = 1:9), geometry = metros)
st_intersects(metros, metros)
plot(metros[-5,])
st_centroid(metros) %>%
  st_coordinates
```
-->
<div class="figure" style="text-align: center"><span id="fig:metro-areas"></span>
<img src="figures/08_metro_areas.png" alt="The aggregated population raster (resolution: 20 km) with the identified metropolitan areas (golden polygons) and the corresponding names." width="450" />
<p class="caption">
Figure 13.2: The aggregated population raster (resolution: 20 km) with the identified metropolitan areas (golden polygons) and the corresponding names.
</p>
</div>
<p>The resulting eight metropolitan areas suitable for bike shops (Fig. <a href="location.html#fig:metro-areas">13.2</a>; see also <code>code/13-location-jm.R</code> for creating the figure) are still missing a name.
A reverse geocoding approach can settle this problem.
Given a coordinate, reverse geocoding finds the corresponding address.
Consequently, extracting the centroid coordinate of each metropolitan area can serve as an input for a reverse geocoding API.
The <strong>revgeo</strong> package provides access to the open source Photon geocoder for OpenStreetMap, Google Maps and Bing.
By default, it uses the Photon API.
<code>revgeo::revgeo()</code> only accepts geographical coordinates (latitude/longitude), therefore, the first requirement is to bring the metropolitan polygons into an appropriate coordinate reference system (Chapter <a href="reproj-geo-data.html#reproj-geo-data">6</a>).</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1">metros_wgs =<span class="st"> </span><span class="kw">st_transform</span>(metros, <span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb429-2" data-line-number="2">coords =<span class="st"> </span><span class="kw">st_centroid</span>(metros_wgs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-3" data-line-number="3"><span class="st">  </span><span class="kw">st_coordinates</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-4" data-line-number="4"><span class="st">  </span><span class="kw">round</span>(<span class="dv">4</span>)</a></code></pre></div>
<p>It is a great feature of <code>revgeo::revgeo()</code> that it accepts also more than one coordinate pair as input (parameters <code>longitude</code> and <code>latitude</code>), which spares us the need for writing a loop.</p>
<p>Choosing <code>frame</code> as <code>revgeocode()</code>’s <code>output</code> option will give back a <code>data.frame</code> with several columns referring to the location including the street name, house number and city.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" data-line-number="1"><span class="kw">library</span>(revgeo)</a>
<a class="sourceLine" id="cb430-2" data-line-number="2">metro_names =<span class="st"> </span><span class="kw">revgeo</span>(<span class="dt">longitude =</span> coords[, <span class="dv">1</span>], <span class="dt">latitude =</span> coords[, <span class="dv">2</span>], </a>
<a class="sourceLine" id="cb430-3" data-line-number="3">                     <span class="dt">output =</span> <span class="st">&quot;frame&quot;</span>)</a></code></pre></div>
<p>To make sure that the reader uses the exact same results, we have put them into <strong>spDataLarge</strong>:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1"><span class="co"># attach metro_names from spDataLarge</span></a>
<a class="sourceLine" id="cb431-2" data-line-number="2"><span class="kw">data</span>(<span class="st">&quot;metro_names&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a></code></pre></div>
<table>
<caption><span id="tab:metro-names">Table 13.2: </span>Result of the reverse geocoding.</caption>
<thead>
<tr class="header">
<th align="left">city</th>
<th align="left">state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hamburg</td>
<td align="left">Hamburg</td>
</tr>
<tr class="even">
<td align="left">Berlin</td>
<td align="left">Berlin</td>
</tr>
<tr class="odd">
<td align="left">Wülfrath</td>
<td align="left">North Rhine-Westphalia</td>
</tr>
<tr class="even">
<td align="left">Leipzig</td>
<td align="left">Saxony</td>
</tr>
<tr class="odd">
<td align="left">Frankfurt am Main</td>
<td align="left">Hesse</td>
</tr>
<tr class="even">
<td align="left">Nuremberg</td>
<td align="left">Bavaria</td>
</tr>
<tr class="odd">
<td align="left">Stuttgart</td>
<td align="left">Baden-Württemberg</td>
</tr>
<tr class="even">
<td align="left">Munich</td>
<td align="left">Bavaria</td>
</tr>
</tbody>
</table>
<p>Overall, we are satisfied with the <code>city</code> column serving as metropolitan names (Table <a href="location.html#tab:metro-names">13.2</a>) apart from one exception, namely Wülfrath which belongs to the greater region of Düsseldorf.
Hence, we replace Wülfrath with Duesseldorf (Fig. <a href="location.html#fig:metro-areas">13.2</a>).
Umlauts like <code>ü</code> might lead to trouble further on, for example when determining the bounding box of a metropolitan area with <code>opq()</code> (see further below), which is why we avoid them.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1">metro_names =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">pull</span>(metro_names, city) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-2" data-line-number="2"><span class="st">  </span>as.character <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-3" data-line-number="3"><span class="st">  </span><span class="kw">ifelse</span>(. <span class="op">==</span><span class="st"> &quot;Wülfrath&quot;, &quot;</span>Duesseldorf<span class="st">&quot;, .)</span></a></code></pre></div>
</div>
<div id="points-of-interest" class="section level2">
<h2><span class="header-section-number">13.6</span> Points of interest</h2>
<p>The <strong>osmdata</strong> package provides easy-to-use access to OSM data (see also section <a href="read-write.html#retrieving-data">7.2</a>).
Instead of downloading shops for the whole of Germany, we restrict the query to the defined metropolitan areas, reducing computational load and providing shop locations only in areas of interest.
The subsequent code chunk does this using a number of functions including:</p>
<ul>
<li><code>map()</code> (the <strong>tidyverse</strong> equivalent of <code>lapply()</code>), which iterates through all eight metropolitan names which subsequently define the bounding box in the OSM query function <code>opq()</code> (see section <a href="read-write.html#retrieving-data">7.2</a>).
<!-- Alternatively, we could have provided the bounding box in the form of coordinates ourselves. --></li>
<li><code>add_osm_feature()</code> to specify OSM elements with a key value of <code>shop</code> (see <a href="http://wiki.openstreetmap.org/wiki/Map_Features">wiki.openstreetmap.org</a> for a list of common key:value pairs).</li>
<li><code>osmdata_sf()</code>, which converts the the OSM data into spatial objects (of class <code>sf</code>).</li>
<li><code>while()</code>, which tries repeatedly (three times in this case) to download the data if it fails first time.<a href="#fn75" class="footnote-ref" id="fnref75"><sup>75</sup></a>
Before running this code: please consider it will download almost 2GB of data.
To save time and resources we have output into <strong>spDataLarge</strong> and should already be available in your environment as an object called <code>shops</code>.</li>
</ul>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1">shops =<span class="st"> </span><span class="kw">map</span>(metro_names, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb433-2" data-line-number="2">  <span class="kw">message</span>(<span class="st">&quot;Downloading shops of: &quot;</span>, x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb433-3" data-line-number="3">  <span class="co"># give the server a bit time</span></a>
<a class="sourceLine" id="cb433-4" data-line-number="4">  <span class="kw">Sys.sleep</span>(<span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="fl">0.1</span>), <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb433-5" data-line-number="5">  query =<span class="st"> </span><span class="kw">opq</span>(x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb433-6" data-line-number="6"><span class="st">    </span><span class="kw">add_osm_feature</span>(<span class="dt">key =</span> <span class="st">&quot;shop&quot;</span>)</a>
<a class="sourceLine" id="cb433-7" data-line-number="7">  points =<span class="st"> </span><span class="kw">osmdata_sf</span>(query)</a>
<a class="sourceLine" id="cb433-8" data-line-number="8">  <span class="co"># request the same data again if nothing has been downloaded</span></a>
<a class="sourceLine" id="cb433-9" data-line-number="9">  iter =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb433-10" data-line-number="10">  <span class="cf">while</span> (<span class="kw">nrow</span>(points<span class="op">$</span>osm_points) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>iter <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb433-11" data-line-number="11">    points =<span class="st"> </span><span class="kw">osmdata_sf</span>(query)</a>
<a class="sourceLine" id="cb433-12" data-line-number="12">    iter =<span class="st"> </span>iter <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb433-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb433-14" data-line-number="14">  points =<span class="st"> </span><span class="kw">st_set_crs</span>(points<span class="op">$</span>osm_points, <span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb433-15" data-line-number="15">})</a></code></pre></div>
<p>It is highly unlikely that there are no shops in any of our defined metropolitan areas.
The following <code>if</code> condition simply checks if there is at least one shop for each region.
If not, we would try to download the shops again for this/these specific region/s.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1"><span class="co"># checking if we have downloaded shops for each metropolitan area</span></a>
<a class="sourceLine" id="cb434-2" data-line-number="2">ind =<span class="st"> </span><span class="kw">map</span>(shops, nrow) <span class="op">==</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb434-3" data-line-number="3"><span class="cf">if</span> (<span class="kw">any</span>(ind)) {</a>
<a class="sourceLine" id="cb434-4" data-line-number="4">  <span class="kw">message</span>(<span class="st">&quot;There are/is still (a) metropolitan area/s without any features:</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb434-5" data-line-number="5">          <span class="kw">paste</span>(metro_names[ind], <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Please fix it!&quot;</span>)</a>
<a class="sourceLine" id="cb434-6" data-line-number="6">}</a></code></pre></div>
<p>To make sure that each list element (an <code>sf</code> data frame) comes with the same columns, we only keep the <code>osm_id</code> and the <code>shop</code> columns with the help of another <code>map</code> loop.
This is not a given since OSM contributors are not equally meticulous when collecting data.
Finally, we <code>rbind</code> all shops into one large <code>sf</code> object.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1"><span class="co"># select only specific columns</span></a>
<a class="sourceLine" id="cb435-2" data-line-number="2">shops =<span class="st"> </span><span class="kw">map</span>(shops, dplyr<span class="op">::</span>select, osm_id, shop)</a>
<a class="sourceLine" id="cb435-3" data-line-number="3"><span class="co"># putting all list elements into a single dataframe</span></a>
<a class="sourceLine" id="cb435-4" data-line-number="4">shops =<span class="st"> </span><span class="kw">do.call</span>(rbind, shops)</a></code></pre></div>
<p>It would have been easier to simply use <code>map_dfr()</code>.
Unfortunately, so far it does not work in harmony with <code>sf</code> objects.
Please note that the <code>shops</code> object is also available in the <code>spDataLarge</code> package:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;shops&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</a></code></pre></div>
<p>The only thing left to do is to convert the spatial point object into a raster (see section <a href="geometric-operations.html#rasterization">5.4.3</a>).
The <code>sf</code> object, <code>shops</code>, is converted into a raster having the same parameters (dimensions, resolution, CRS) as the <code>reclass</code> object.
Importantly, the <code>count()</code> function is used here to calculate the number shops in each cell.</p>

<div class="rmdnote">
If the <code>shop</code> column were used instead of the <code>osm_id</code> column, we would have retrieved fewer shops per grid cell.
This is because the <code>shop</code> column contains <code>NA</code> values, which the <code>count()</code> function omits when rasterizing vector objects.
</div>

<p>The result of the subsequent code chunk is therefore an estimate of shop density (shops/km<sup>2</sup>).
<code>st_transform()</code> is used before <code>rasterize()</code> to ensure the CRS of both inputs match.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" data-line-number="1">shops =<span class="st"> </span><span class="kw">st_transform</span>(shops, <span class="kw">proj4string</span>(reclass))</a>
<a class="sourceLine" id="cb437-2" data-line-number="2"><span class="co"># create poi raster</span></a>
<a class="sourceLine" id="cb437-3" data-line-number="3">poi =<span class="st"> </span><span class="kw">rasterize</span>(<span class="dt">x =</span> shops, <span class="dt">y =</span> reclass, <span class="dt">field =</span> <span class="st">&quot;osm_id&quot;</span>, <span class="dt">fun =</span> <span class="st">&quot;count&quot;</span>)</a></code></pre></div>
<p>As with the other raster layers (population, women, mean age, household size) the <code>poi</code> raster is reclassified into four classes (see section <a href="location.html#create-census-rasters">13.4</a>).
Defining class intervals is an arbitrary undertaking to a certain degree.
One can use equal breaks, quantile breaks, fixed values or others.
Here, we choose the Fisher-Jenks natural breaks approach which minimizes within-class variance, the result of which provides an input for the reclassification matrix.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1"><span class="co"># construct reclassification matrix</span></a>
<a class="sourceLine" id="cb438-2" data-line-number="2">int =<span class="st"> </span>classInt<span class="op">::</span><span class="kw">classIntervals</span>(<span class="kw">values</span>(poi), <span class="dt">n =</span> <span class="dv">4</span>, <span class="dt">style =</span> <span class="st">&quot;fisher&quot;</span>)</a>
<a class="sourceLine" id="cb438-3" data-line-number="3">int =<span class="st"> </span><span class="kw">round</span>(int<span class="op">$</span>brks)</a>
<a class="sourceLine" id="cb438-4" data-line-number="4">rcl_poi =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(int[<span class="dv">1</span>], <span class="kw">rep</span>(int[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">length</span>(int))], <span class="dt">each =</span> <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb438-5" data-line-number="5">                   int[<span class="kw">length</span>(int)] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb438-6" data-line-number="6">rcl_poi =<span class="st"> </span><span class="kw">cbind</span>(rcl_poi, <span class="dv">0</span><span class="op">:</span><span class="dv">3</span>)  </a>
<a class="sourceLine" id="cb438-7" data-line-number="7"><span class="co"># reclassify</span></a>
<a class="sourceLine" id="cb438-8" data-line-number="8">poi =<span class="st"> </span><span class="kw">reclassify</span>(poi, <span class="dt">rcl =</span> rcl_poi, <span class="dt">right =</span> <span class="ot">NA</span>) </a>
<a class="sourceLine" id="cb438-9" data-line-number="9"><span class="kw">names</span>(poi) =<span class="st"> &quot;poi&quot;</span></a></code></pre></div>
</div>
<div id="identifying-suitable-locations" class="section level2">
<h2><span class="header-section-number">13.7</span> Identifying suitable locations</h2>
<p>The only steps that remain before combining all the layers are to add POI and delete the population from the raster stack.
The reasoning for the latter is twofold.
First of all, we have already delineated metropolitan areas, that is areas where the population density is above average compared to the rest of Germany.
Secondly, though it is advantageous to have many potential customers within a specific catchment area, the sheer number alone might not actually represent the desired target group.
For instance, residential tower blocks are areas with a high population density but not necessarily with a high purchasing power for expensive cycle components.
This is achieved with the complimentary functions <code>addLayer()</code> and <code>dropLayer()</code>:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" data-line-number="1"><span class="co"># add poi raster</span></a>
<a class="sourceLine" id="cb439-2" data-line-number="2">reclass =<span class="st"> </span><span class="kw">addLayer</span>(reclass, poi)</a>
<a class="sourceLine" id="cb439-3" data-line-number="3"><span class="co"># delete population raster</span></a>
<a class="sourceLine" id="cb439-4" data-line-number="4">reclass =<span class="st"> </span><span class="kw">dropLayer</span>(reclass, <span class="st">&quot;pop&quot;</span>)</a></code></pre></div>
<p>In common with other data science projects, data retrieval and ‘tidying’ have consumed much of the overall workload so far.
With clean data the final step, calculating a final score by summing up all raster layers, can be accomplished in a single line.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1"><span class="co"># calculate the total score</span></a>
<a class="sourceLine" id="cb440-2" data-line-number="2">result =<span class="st"> </span><span class="kw">sum</span>(reclass)</a></code></pre></div>
<p>For instance, a score greater than 9 might be a suitable threshold indicating raster cells where a bike shop could be placed (Figure <a href="location.html#fig:bikeshop-berlin">13.3</a>; see also <code>code/13-location-jm.R</code>).</p>
<div class="figure" style="text-align: center"><span id="fig:bikeshop-berlin"></span>
<div id="htmlwidget-ec897849c5c50a6f7846" style="width:576px;height:355.968px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-ec897849c5c50a6f7846">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAM0lEQVRYhe3SMQ0AMAwEsQcb/hTSuQSaVLIR3HAJAADfqfR0wm1dEC9VevcCq+MAAIBhB20vBvBK3JZrAAAAAElFTkSuQmCC",[[52.696600856383,13.0820026147986],[52.3210740877061,13.6981591380976]],0.8,null,null,null]},{"method":"addLegend","args":[{"colors":["darkgreen"],"labels":["potential locations"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"bottomright","type":"unknown","title":"Legend","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[52.3210740877061,52.696600856383],"lng":[13.0820026147986,13.6981591380976]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 13.3: Suitable areas (i.e. raster cells with a score &gt; 9) in accordance with our hypothetical survey for bike stores in Berlin.
</p>
</div>
</div>
<div id="discussion-and-next-steps" class="section level2">
<h2><span class="header-section-number">13.8</span> Discussion and next steps</h2>
<p>The presented approach is a typical example of the normative usage of a GIS <span class="citation">(Longley <a href="#ref-longley_geographic_2015">2015</a>)</span>.
We combined survey data with expert-based knowledge and assumptions (definition of metropolitan areas, defining class intervals, definition of a final score threshold).
It should be clear that this approach is not suitable for scientific knowledge advancement but is a very applied way of information extraction.
This is to say, we can only suspect based on common sense that we have identified areas suitable for bike shops.
However, we have no proof that this is in fact the case.</p>
<p>A few other things remained unconsidered but might improve the analysis:</p>
<ul>
<li>We used equal weights when calculating the final scores.
But is, for example, the household size as important as the portion of women or the mean age?</li>
<li>We used all points of interest.
Maybe it would be wiser to use only those which might be interesting for bike shops such as do-it-yourself, hardware, bicycle, fishing, hunting, motorcycles, outdoor and sports shops (see the range of shop values available on the <a href="http://wiki.openstreetmap.org/wiki/Map_Features#Shop">OSM Wiki</a>).</li>
<li>Data at a better resolution may change and improve the output. For example, there is also population data at a finer resolution (100 m; see exercises).</li>
<li>We have used only a limited set of variables.
For example, the <a href="http://inspire-geoportal.ec.europa.eu/discovery/">INSPIRE geoportal</a> might contain much more data of possible interest to our analysis (see also section <a href="read-write.html#retrieving-data">7.2</a>.
The bike paths density might be another interesting variable as well as the purchasing power or even better the retail purchasing power for bikes.</li>
<li>Interactions remained unconsidered, such as a possible interaction between the portion of men and single households.
However, to find out about such an interaction we would need customer data.</li>
</ul>
<p>In short, the presented analysis is far from perfect.
Nevertheless, it should have given you a first impression and understanding of how to obtain, and deal with spatial data in R within a geomarketing context.</p>
<p>Finally, we have to point out that the presented analysis would be merely the first step of finding suitable locations.
So far we have identified areas, 1 by 1 km in size, potentially suitable for a bike shop in accordance with our survey.
We could continue the analysis as follows:</p>
<ul>
<li>Find an optimal location based on number of inhabitants within a specific catchment area.
For example, the shop should be reachable for as many people as possible within 15 minutes of traveling bike distance (catchment area routing).
Thereby, we should account for the fact that the further away the people are from the shop, the more unlikely it becomes that they actually visit it (distance decay function).</li>
<li>Also it would be a good idea to take into account competitors.
That is, if there already is a bike shop in the vicinity of the chosen location, one has to distribute possible customers (or sales potential) between the competitors <span class="citation">(Huff <a href="#ref-huff_probabilistic_1963">1963</a>; Wieland <a href="#ref-wieland_market_2017">2017</a>)</span>.</li>
<li>We need to find suitable and affordable real estate (accessible, parking spots, frequency of passers-by, big windows, etc.).</li>
</ul>
</div>
<div id="exercises-9" class="section level2">
<h2><span class="header-section-number">13.9</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>We have used <code>raster::rasterFromXYZ()</code> to convert a <code>input_tidy</code> into a raster brick.
Try to achieve the same with the help of the <code>sp::gridded()</code> function.
<!--
input = st_as_sf(input, coords = c("x", "y"))
# use the correct projection (see data description)
input = st_set_crs(input, 3035)
# convert into an sp-object
input = as(input, "Spatial")
gridded(input) = TRUE
# convert into a raster stack
input = stack(input)
--></p></li>
<li><p>Download the csv file containing inhabitant information for a 100 m cell resolution (<a href="https://www.zensus2011.de/SharedDocs/Downloads/DE/Pressemitteilung/DemografischeGrunddaten/csv_Bevoelkerung_100m_Gitter.zip?__blob=publicationFile&amp;v=3" class="uri">https://www.zensus2011.de/SharedDocs/Downloads/DE/Pressemitteilung/DemografischeGrunddaten/csv_Bevoelkerung_100m_Gitter.zip?__blob=publicationFile&amp;v=3</a>).
Please note that the unzipped file has a size of 1.23 GB.
To read it into R you can use <code>readr::read_csv</code>.
This takes 30 seconds on my machine (16 GB RAM)
<code>data.table::fread()</code> might be even faster, and returns an object of class <code>data.table()</code>.
Use <code>as.tibble()</code> to convert it into a tibble.
Build an inhabitant raster, aggregate it to a cell resolution of 1 km, and compare the difference with the inhabitant raster (<code>inh</code>) we have created using class mean values.</p></li>
<li><p>Suppose our bike shop predominantly sold electric bikes to older people.
Change the age raster accordingly, repeat the remaining analyses and compare the changes with our original result.</p></li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-tomintz_geography_2008">
<p>Tomintz, Melanie N M.N., Graham P Clarke, and Janette E J.E. Rigby. 2008. “The Geography of Smoking in Leeds: Estimating Individual Smoking Rates and the Implications for the Location of Stop Smoking Services.” <em>Area</em> 40 (3): 341–53.</p>
</div>
<div id="ref-muenchow_review_2018">
<p>Muenchow, Jannes, Petra Dieker, Jürgen Kluge, Michael Kessler, and Henrik von Wehrden. 2018. “A Review of Ecological Gradient Research in the Tropics: Identifying Research Gaps, Future Directions, and Conservation Priorities.” <em>Biodiversity and Conservation</em> 27 (2): 273–85. <a href="https://doi.org/10.1007/s10531-017-1465-y" class="uri">https://doi.org/10.1007/s10531-017-1465-y</a>.</p>
</div>
<div id="ref-longley_geographic_2015">
<p>Longley, Paul. 2015. <em>Geographic Information Science &amp; Systems</em>. Fourth edition. Hoboken, NJ: Wiley.</p>
</div>
<div id="ref-huff_probabilistic_1963">
<p>Huff, David L. 1963. “A Probabilistic Analysis of Shopping Center Trade Areas.” <em>Land Economics</em> 39 (1): 81–90. <a href="https://doi.org/10.2307/3144521" class="uri">https://doi.org/10.2307/3144521</a>.</p>
</div>
<div id="ref-wieland_market_2017">
<p>Wieland, Thomas. 2017. “Market Area Analysis for Retail and Service Locations with MCI.” <em>The R Journal</em> 9 (1): 298–323.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="74">
<li id="fn74"><p>
The potential error introduced during this reclassification stage will be explored in the exercises.<a href="location.html#fnref74" class="footnote-back">↩</a></p></li>
<li id="fn75"><p>
As with Google’s reverse geocode API, the OSM-download will sometimes fail at the first attempt.<a href="location.html#fnref75" class="footnote-back">↩</a></p></li>
</ol>
</div>
<script>
/*
Sorts the references alphabetically.
Modified from code by Yvonne Aburrow.
*/
$(function(){
    var elems = $('#refs').children('div').remove();
    elems.sort(function (a, b) {
        return $(b).children('p').html().toUpperCase() > $(a).children('p').html().toUpperCase() ? -1 : 1;
    });
    $('#refs').append(elems);
})
</script>
            </section>

          </div>
        </div>
      </div>
<a href="transport.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="eco.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Robinlovelace/geocompr/edit/master/13-location.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
